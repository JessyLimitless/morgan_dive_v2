<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AX RADAR v5.2</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
/* ================================================================
   AX RADAR v5.2 — Market Pulse + Foreign Flow + Institution Desk + Daily Radar
   Light · Indigo Accent · Ambient Motion · Editorial Layout
   ================================================================ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

:root{
  --f-display:'Plus Jakarta Sans','Noto Sans KR',sans-serif;
  --f-body:'Noto Sans KR','Plus Jakarta Sans',sans-serif;
  --f-mono:'JetBrains Mono','Consolas',monospace;

  --font-display:var(--f-display);
  --font-body:var(--f-body);
  --font-mono:var(--f-mono);

  /* ── Light Surfaces ── */
  --bg:#F7F8FB;
  --bg-card:#FFFFFF;
  --bg-card-2:#F2F4F8;
  --bg-hover:#EAECF3;
  --bg-active:#DDE1EC;
  --bg-page:#F7F8FB;
  --bg-article:#FFFFFF;
  --bg-table-head:#F2F4F8;
  --bg-table-alt:rgba(79,70,229,.015);

  /* ── Text ── */
  --tx-1:#1A1F2E;
  --tx-2:#4A5068;
  --tx-3:#8490A8;
  --tx-inv:#FFFFFF;
  --tx-heading:#1A1F2E;
  --tx-body:#4A5068;
  --tx-secondary:#4A5068;
  --tx-muted:#8490A8;
  --tx-inverse:#FFFFFF;

  /* ── Stock (Red up / Blue down — KRX convention) ── */
  --c-up:#DC2626;
  --c-down:#2563EB;
  --c-flat:#8490A8;

  /* ── Indigo Accent ── */
  --c-accent:#4F46E5;
  --c-accent-deep:#4338CA;
  --c-accent-light:#818CF8;
  --c-accent-bg:rgba(79,70,229,.05);
  --c-accent-bg2:rgba(79,70,229,.09);
  --c-accent-border:rgba(79,70,229,.16);
  --accent-gold:#4F46E5;
  --accent-gold-bright:#818CF8;
  --accent-gold-dim:rgba(79,70,229,.05);

  /* ── Semantic Colors ── */
  --accent-blue:#2563EB;
  --accent-red:#DC2626;
  --accent-green:#15803D;
  --accent-purple:#6D28D9;
  --accent-cyan:#0E7490;
  --accent-pink:#BE185D;

  /* ── Signal ── */
  --c-foreign:#D97706;

  /* ── Borders ── */
  --b-light:#ECEEF3;
  --b-default:#DFE2EA;
  --b-strong:#CDD1DC;
  --border:#ECEEF3;
  --border-strong:#DFE2EA;
  --border-accent:rgba(79,70,229,.16);

  /* ── Shadows ── */
  --s-sm:0 1px 2px rgba(26,31,46,.04);
  --s-md:0 2px 8px rgba(26,31,46,.06);
  --s-lg:0 4px 20px rgba(26,31,46,.08);
  --s-xl:0 12px 40px rgba(26,31,46,.10);
  --s-glow:0 0 20px rgba(79,70,229,.06);
  --s-hover:0 8px 28px rgba(79,70,229,.06),0 2px 6px rgba(26,31,46,.04);
  --shadow-sm:0 1px 2px rgba(26,31,46,.04);
  --shadow-md:0 2px 8px rgba(26,31,46,.06);
  --shadow-card:0 2px 8px rgba(26,31,46,.06),0 0 20px rgba(79,70,229,.04);
  --shadow-hover:0 8px 28px rgba(79,70,229,.06),0 2px 6px rgba(26,31,46,.04);

  --r-sm:8px;--r-md:12px;--r-lg:16px;--r-xl:20px;
  --radius-sm:8px;--radius-md:12px;--radius-lg:16px;--radius-xl:20px;
  --ease:cubic-bezier(.22,1,.36,1);
  --transition-fast:200ms cubic-bezier(.22,1,.36,1);
  --transition-normal:300ms cubic-bezier(.22,1,.36,1);
}

html{font-size:16px;scroll-behavior:smooth}
body{
  font-family:var(--f-body);background:var(--bg);color:var(--tx-1);
  line-height:1.6;letter-spacing:-.01em;padding-bottom:48px;
  -webkit-font-smoothing:antialiased;overflow-x:hidden;
}

/* ── Ambient Background ── */
body::before{
  content:'';position:fixed;inset:0;z-index:0;pointer-events:none;
  background:
    radial-gradient(ellipse 70% 50% at 15% 0%, rgba(79,70,229,.04) 0%,transparent 50%),
    radial-gradient(ellipse 60% 45% at 85% 15%,rgba(37,99,235,.03) 0%,transparent 45%),
    radial-gradient(ellipse 65% 50% at 50% 100%,rgba(79,70,229,.03) 0%,transparent 50%);
  animation:ambientShift 25s ease-in-out infinite alternate;
}
@keyframes ambientShift{
  0%{opacity:.7;transform:scale(1)}
  50%{opacity:1;transform:scale(1.02) translateY(-6px)}
  100%{opacity:.8;transform:scale(1.01) translateY(3px)}
}

::selection{background:rgba(79,70,229,.12)}
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--b-default);border-radius:3px}
.up{color:var(--c-up)}.dn{color:var(--c-down)}.fl{color:var(--c-flat)}


/* ================================================================
   HEADER
   ================================================================ */
.header{
  position:sticky;top:0;z-index:100;
  display:flex;align-items:center;justify-content:space-between;
  padding:0 36px;height:64px;
  background:rgba(247,248,251,.92);
  border-bottom:1px solid var(--b-light);
  box-shadow:0 1px 0 rgba(79,70,229,.04),0 4px 16px rgba(26,31,46,.03);
  backdrop-filter:blur(20px) saturate(1.2);
}
.header__brand{display:flex;align-items:center;gap:10px}
.header__brand h1{
  font-family:var(--f-display);font-size:1.25rem;font-weight:800;
  letter-spacing:-.4px;
  background:linear-gradient(135deg,var(--tx-1) 40%,var(--c-accent));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
}
.header__brand .ver{
  font-family:var(--f-mono);font-size:.68rem;font-weight:600;
  color:var(--c-accent);background:var(--c-accent-bg);
  border:1px solid var(--c-accent-border);
  padding:2px 7px;border-radius:4px;letter-spacing:.5px;
}
.header__nav{display:flex;gap:2px}
.nav-link{
  font-family:var(--f-display);font-size:.84rem;font-weight:600;
  color:var(--tx-3);text-decoration:none;
  padding:8px 18px;border-radius:var(--r-sm);
  transition:all .2s var(--ease);cursor:pointer;
  display:inline-flex;align-items:center;gap:7px;
}
.nav-link::before{
  content:'';display:inline-block;width:6px;height:6px;border-radius:50%;
  flex-shrink:0;opacity:.5;transition:opacity .2s;
}
.nav-link[data-target="radar"]::before{background:#2563EB}
.nav-link:hover{color:var(--tx-2);background:var(--c-accent-bg)}
.nav-link:hover::before{opacity:.8}
.nav-link.active{color:var(--c-accent);background:var(--c-accent-bg);font-weight:700}
.nav-link.active::before{opacity:1}
.header__right{display:flex;align-items:center;gap:16px}
.live-dot{
  display:inline-flex;align-items:center;gap:6px;
  font-family:var(--f-mono);font-size:11px;font-weight:700;
  text-transform:uppercase;letter-spacing:1px;
}
.live-dot.on{color:#059669}
.live-dot.off{color:var(--c-up)}
.live-dot.on::before{
  content:'';width:6px;height:6px;background:#059669;border-radius:50%;
  box-shadow:0 0 6px rgba(5,150,105,.4);
  animation:pulse 2s ease-in-out infinite;
}
.live-dot.off::before{
  content:'';width:6px;height:6px;background:var(--c-up);border-radius:50%;
  animation:pulseOff 2s ease-in-out infinite;
}
@keyframes pulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.3);opacity:.5}}
@keyframes pulseOff{0%,100%{opacity:1}50%{opacity:.35}}
.header__clock{font-family:var(--f-mono);font-size:.84rem;color:var(--tx-3);font-variant-numeric:tabular-nums}


/* ================================================================
   LAYOUT — Full Width
   ================================================================ */
.content{position:relative;z-index:1;padding:0 36px}
.data-grid{max-width:1600px;margin:0 auto}

/* ── Section System ── */
.sec-label{
  display:flex;align-items:center;gap:14px;
  margin-bottom:24px;
}
.sec-tag{
  font-family:var(--f-mono);font-size:11px;font-weight:800;
  color:var(--c-accent);text-transform:uppercase;letter-spacing:2.5px;
  display:flex;align-items:center;gap:8px;
  white-space:nowrap;
}
.sec-tag::before{
  content:'';width:6px;height:6px;
  background:var(--c-accent);border-radius:2px;
  transform:rotate(45deg);flex-shrink:0;
}
.sec-line{flex:1;height:1px;background:linear-gradient(90deg,var(--b-default),transparent)}


/* ================================================================
   MARKET PULSE — KOSPI / KOSDAQ / NASDAQ
   ================================================================ */
.pulse-sec{padding:28px 0 10px}
.pulse-row{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
.idx-card{
  background:var(--bg-card);border:1px solid var(--b-light);
  border-radius:var(--r-lg);padding:22px 28px;
  transition:all .3s var(--ease);animation:fadeUp .4s var(--ease) backwards;
  position:relative;overflow:hidden;
}
.idx-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,rgba(79,70,229,.12),rgba(79,70,229,.22),rgba(79,70,229,.12),transparent);
  background-size:200% 100%;animation:flowLine 4s ease-in-out infinite;
}
.idx-card:hover{box-shadow:var(--s-hover);border-color:rgba(79,70,229,.1)}
.idx-lbl{
  font-family:var(--f-mono);font-size:11px;font-weight:700;
  color:var(--tx-3);text-transform:uppercase;letter-spacing:1.8px;
  margin-bottom:8px;display:flex;align-items:center;gap:8px;
}
.idx-flag{font-style:normal;font-size:14px}
.idx-val{
  font-family:var(--f-mono);font-size:1.65rem;font-weight:800;
  color:var(--tx-1);margin-bottom:4px;font-variant-numeric:tabular-nums;
}
.idx-chg{
  font-family:var(--f-mono);font-size:.88rem;font-weight:700;
  font-variant-numeric:tabular-nums;
}


/* ================================================================
   CARD — Shared card style
   ================================================================ */
.flow-sec{padding:18px 0 30px}

.card{
  background:var(--bg-card);border:1px solid var(--b-light);
  border-radius:var(--r-lg);overflow:hidden;
  transition:all .3s var(--ease);animation:fadeUp .45s var(--ease) backwards;
  position:relative;
}
.card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,rgba(79,70,229,.12),rgba(79,70,229,.22),rgba(79,70,229,.12),transparent);
  background-size:200% 100%;animation:flowLine 4s ease-in-out infinite;
}
@keyframes flowLine{0%{background-position:-100% 0}100%{background-position:200% 0}}
.card:hover{box-shadow:var(--s-hover);border-color:rgba(79,70,229,.1)}
.card__head{
  display:flex;align-items:center;justify-content:space-between;
  padding:18px 26px 16px;border-bottom:1px solid var(--b-light);
}
.card__title{font-family:var(--f-mono);font-size:11px;font-weight:700;color:var(--tx-3);text-transform:uppercase;letter-spacing:1.8px}
.card__sub{font-family:var(--f-mono);font-size:.74rem;color:var(--tx-3);background:var(--bg-card-2);padding:4px 10px;border-radius:4px;border:1px solid var(--b-light)}
.card__body{padding:18px 26px}

/* Foreign */
.foreign-grid{display:grid;grid-template-columns:1fr 1fr;gap:28px}
.foreign-hd{display:flex;align-items:center;justify-content:space-between;font-family:var(--f-mono);font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:1.5px;padding-bottom:10px;margin-bottom:8px;border-bottom:2px solid}
.foreign-hd.buy{color:var(--c-up);border-color:rgba(220,38,38,.15)}
.foreign-hd.sell{color:var(--c-down);border-color:rgba(37,99,235,.15)}
.foreign-hd .fc-cnt{font-size:10px;font-weight:600;opacity:.5}
.foreign-list{max-height:680px;overflow-y:auto;scrollbar-width:thin}
.fi-item{display:flex;align-items:center;gap:10px;padding:10px 8px;border-bottom:1px solid var(--b-light);cursor:pointer;transition:all .2s var(--ease);border-radius:6px}
.fi-item:last-child{border-bottom:none}
.fi-item:hover{background:var(--c-accent-bg);margin:0 -6px;padding:8px 12px;transform:translateX(2px)}
.fi-rk{font-family:var(--f-mono);font-size:12px;font-weight:700;color:var(--tx-3);min-width:24px;text-align:center;font-variant-numeric:tabular-nums}
.fi-rk-1{color:var(--c-up);font-weight:800}
.fi-rk-2{color:var(--c-foreign);font-weight:800}
.fi-rk-3{color:var(--c-accent);font-weight:800}
.fi-nm{flex-shrink:0;max-width:120px;font-size:.88rem;font-weight:600;color:var(--tx-1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.fi-bar-wrap{flex:1;height:10px;border-radius:5px;overflow:hidden;min-width:20px;background:transparent}
.fi-fill{height:100%;border-radius:5px;transition:width .6s ease-out}
.fi-amt{font-family:var(--f-mono);font-size:.84rem;font-weight:700;text-align:right;min-width:58px;font-variant-numeric:tabular-nums;flex-shrink:0}
.fi-amt.buy{color:var(--c-up)}.fi-amt.sell{color:var(--c-down)}
.fi-chg{font-family:var(--f-mono);font-size:.72rem;font-weight:600;text-align:right;min-width:48px;font-variant-numeric:tabular-nums;flex-shrink:0}


/* ================================================================
   SECTOR FLOW — Diverging Bar Chart
   ================================================================ */
.sector-chart{padding:8px 0 4px}
.sector-row{
  display:flex;align-items:center;gap:0;
  padding:7px 0;border-bottom:1px solid var(--b-light);
  transition:background .15s var(--ease);
}
.sector-row:last-child{border-bottom:none}
.sector-row:hover{background:var(--c-accent-bg)}
.sector-nm{
  width:80px;flex-shrink:0;text-align:right;padding-right:12px;
  font-family:var(--f-body);font-size:.82rem;font-weight:600;
  color:var(--tx-1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.sector-bar-wrap{
  flex:1;display:flex;align-items:center;gap:0;
  position:relative;height:24px;
}
.sector-bar-left{
  flex:1;display:flex;justify-content:flex-end;align-items:center;
  height:100%;position:relative;
}
.sector-bar-right{
  flex:1;display:flex;justify-content:flex-start;align-items:center;
  height:100%;position:relative;
}
.sector-axis{
  width:1px;height:28px;background:var(--tx-3);opacity:.25;flex-shrink:0;
}
.sector-bar{
  height:18px;border-radius:3px;
  min-width:2px;
  transition:width .6s cubic-bezier(.22,1,.36,1);
}
.sector-bar.buy{
  background:linear-gradient(90deg,rgba(220,38,38,.15),rgba(220,38,38,.55));
  margin-left:4px;
}
.sector-bar.sell{
  background:linear-gradient(270deg,rgba(37,99,235,.15),rgba(37,99,235,.55));
  margin-right:4px;
}
.sector-amt{
  width:76px;flex-shrink:0;text-align:right;padding-left:8px;
  font-family:var(--f-mono);font-size:.78rem;font-weight:700;
  font-variant-numeric:tabular-nums;
}
.sector-amt.buy{color:var(--c-up)}
.sector-amt.sell{color:var(--c-down)}
.sector-amt.zero{color:var(--tx-3)}
.sector-header-row{
  display:flex;align-items:center;gap:0;
  padding:0 0 8px;margin-bottom:4px;
  border-bottom:2px solid var(--b-default);
}
.sector-header-row .sector-nm{
  font-family:var(--f-mono);font-size:10px;font-weight:700;
  color:var(--tx-3);text-transform:uppercase;letter-spacing:1px;
}
.sector-header-row .sector-bar-wrap{
  font-family:var(--f-mono);font-size:10px;font-weight:700;
  color:var(--tx-3);text-transform:uppercase;letter-spacing:1px;
  display:flex;justify-content:center;
}
.sector-header-row .sector-bar-left{justify-content:center}
.sector-header-row .sector-bar-right{justify-content:center}
.sector-header-row .sector-amt{
  font-size:10px;font-weight:700;color:var(--tx-3);
  text-transform:uppercase;letter-spacing:1px;
}

@media(max-width:768px){
  .sector-nm{width:64px;font-size:.76rem}
  .sector-amt{width:64px;font-size:.72rem}
}

/* ── Sector Tabs ── */
.sector-tabs{display:flex;gap:2px;background:var(--bg-card-2);border-radius:6px;padding:2px}
.sector-tab{
  font-family:var(--f-mono);font-size:11px;font-weight:700;
  text-transform:uppercase;letter-spacing:1px;
  padding:6px 16px;border-radius:5px;border:none;
  background:transparent;color:var(--tx-3);cursor:pointer;
  transition:all .2s var(--ease);
}
.sector-tab:hover{color:var(--tx-2)}
.sector-tab.active{background:var(--bg-card);color:var(--c-accent);box-shadow:var(--s-sm)}

/* ── IB Sector Flow ── */
.ib-sector-cols{display:grid;grid-template-columns:repeat(3,1fr);gap:0}
.ib-sector-col{padding:18px 22px}
.ib-sector-col:not(:last-child){border-right:1px solid var(--b-light)}
.ib-sector-col-hd{
  display:flex;align-items:center;gap:10px;margin-bottom:14px;
  padding-bottom:10px;border-bottom:2px solid var(--b-default);
}
.ib-sector-col-hd .ib-col-logo{width:30px;height:30px;font-size:11px}
.ib-sector-col-hd .ib-col-nm{font-family:var(--f-display);font-size:.85rem;font-weight:700;color:var(--tx-1)}
.ib-sector-chart{max-height:500px;overflow-y:auto;scrollbar-width:thin}
.ibs-row{
  display:flex;align-items:center;gap:0;
  padding:5px 0;border-bottom:1px solid var(--b-light);
  transition:background .15s var(--ease);
}
.ibs-row:last-child{border-bottom:none}
.ibs-row:hover{background:var(--c-accent-bg)}
.ibs-nm{
  width:68px;flex-shrink:0;text-align:right;padding-right:10px;
  font-family:var(--f-body);font-size:.78rem;font-weight:600;
  color:var(--tx-1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.ibs-bar-wrap{
  flex:1;display:flex;align-items:center;gap:0;
  position:relative;height:20px;
}
.ibs-bar-left{flex:1;display:flex;justify-content:flex-end;align-items:center;height:100%;position:relative}
.ibs-bar-right{flex:1;display:flex;justify-content:flex-start;align-items:center;height:100%;position:relative}
.ibs-axis{width:1px;height:24px;background:var(--tx-3);opacity:.25;flex-shrink:0}
.ibs-bar{
  height:14px;border-radius:2px;min-width:2px;
  transition:width .6s cubic-bezier(.22,1,.36,1);
}
.ibs-bar.buy{background:linear-gradient(90deg,rgba(220,38,38,.15),rgba(220,38,38,.55));margin-left:3px}
.ibs-bar.sell{background:linear-gradient(270deg,rgba(37,99,235,.15),rgba(37,99,235,.55));margin-right:3px}
.ibs-amt{
  width:64px;flex-shrink:0;text-align:right;padding-left:6px;
  font-family:var(--f-mono);font-size:.72rem;font-weight:700;
  font-variant-numeric:tabular-nums;
}
.ibs-amt.buy{color:var(--c-up)}.ibs-amt.sell{color:var(--c-down)}.ibs-amt.zero{color:var(--tx-3)}

@media(max-width:1024px){
  .ib-sector-cols{grid-template-columns:1fr}
  .ib-sector-col:not(:last-child){border-right:none;border-bottom:1px solid var(--b-light)}
}
@media(max-width:768px){
  .ibs-nm{width:56px;font-size:.72rem}
  .ibs-amt{width:56px;font-size:.68rem}
}


/* ================================================================
   IB CARDS — Institution Desk
   ================================================================ */
.ib-section{padding-bottom:30px}
.ib-cols{display:grid;grid-template-columns:repeat(3,1fr);gap:0}
.ib-col{padding:22px 26px}
.ib-col:not(:last-child){border-right:1px solid var(--b-light)}
.ib-col-hd{display:flex;align-items:center;gap:10px;margin-bottom:14px}
.ib-col-logo{width:36px;height:36px;border-radius:var(--r-sm);display:flex;align-items:center;justify-content:center;font-family:var(--f-display);font-size:13px;font-weight:800;flex-shrink:0}
.ib-col-logo.ms{background:rgba(37,99,235,.07);color:#2563EB;border:1px solid rgba(37,99,235,.12)}
.ib-col-logo.jp{background:rgba(99,102,241,.07);color:#6366F1;border:1px solid rgba(99,102,241,.12)}
.ib-col-logo.gs{background:var(--c-accent-bg2);color:var(--c-accent);border:1px solid var(--c-accent-border)}
.ib-col-nm{font-family:var(--f-display);font-size:.9rem;font-weight:700;color:var(--tx-1)}
.ib-col-cd{font-family:var(--f-mono);font-size:.68rem;color:var(--tx-3);letter-spacing:.5px}
.ib-col-list{list-style:none}

/* ── IB Sub Header (BUY / SELL divider) ── */
.ib-sub-hd{
  font-family:var(--f-mono);font-size:10px;font-weight:800;
  text-transform:uppercase;letter-spacing:1.8px;
  padding:10px 6px 8px;margin-top:4px;
  border-bottom:2px solid;display:flex;align-items:center;gap:6px;
}
.ib-sub-hd.buy{color:var(--c-up);border-color:rgba(220,38,38,.15)}
.ib-sub-hd.sell{color:var(--c-down);border-color:rgba(37,99,235,.15);margin-top:0}

/* ── Sell Toggle Button ── */
.sell-toggle-btn{
  display:flex;align-items:center;justify-content:center;gap:6px;
  width:100%;margin-top:16px;padding:10px 0;
  background:rgba(37,99,235,.04);border:1px solid rgba(37,99,235,.12);
  border-radius:var(--r-sm);cursor:pointer;
  font-family:var(--f-mono);font-size:11px;font-weight:700;
  color:var(--c-down);text-transform:uppercase;letter-spacing:1.2px;
  transition:all .2s var(--ease);
}
.sell-toggle-btn:hover{
  background:rgba(37,99,235,.08);border-color:rgba(37,99,235,.22);
  box-shadow:0 2px 8px rgba(37,99,235,.08);
}
.sell-toggle-btn .arrow{
  display:inline-block;font-size:10px;transition:transform .2s var(--ease);
}

/* ── Sell Popup Overlay ── */
.sell-popup-overlay{
  position:fixed;inset:0;
  background:rgba(26,31,46,.22);
  display:flex;align-items:center;justify-content:center;
  z-index:1000;opacity:0;pointer-events:none;
  transition:opacity .25s var(--ease);
  backdrop-filter:blur(4px);
}
.sell-popup-overlay.on{opacity:1;pointer-events:auto}
.sell-popup{
  background:var(--bg-card);border:1px solid var(--b-light);
  border-radius:var(--r-xl);
  box-shadow:var(--s-xl),0 0 40px rgba(37,99,235,.06);
  width:480px;max-width:92vw;max-height:82vh;
  overflow:hidden;
  animation:sellPopIn .3s var(--ease);
  position:relative;
}
@keyframes sellPopIn{from{opacity:0;transform:scale(.96) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}
.sell-popup::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,rgba(37,99,235,.2),rgba(37,99,235,.35),rgba(37,99,235,.2),transparent);
  border-radius:var(--r-xl) var(--r-xl) 0 0;
}
.sell-popup__head{
  display:flex;align-items:center;justify-content:space-between;
  padding:20px 26px 16px;border-bottom:1px solid var(--b-light);
}
.sell-popup__title{
  display:flex;align-items:center;gap:10px;
}
.sell-popup__logo{
  width:32px;height:32px;border-radius:var(--r-sm);
  display:flex;align-items:center;justify-content:center;
  font-family:var(--f-display);font-size:12px;font-weight:800;flex-shrink:0;
}
.sell-popup__logo.ms{background:rgba(37,99,235,.07);color:#2563EB;border:1px solid rgba(37,99,235,.12)}
.sell-popup__logo.jp{background:rgba(99,102,241,.07);color:#6366F1;border:1px solid rgba(99,102,241,.12)}
.sell-popup__logo.gs{background:var(--c-accent-bg2);color:var(--c-accent);border:1px solid var(--c-accent-border)}
.sell-popup__nm{font-family:var(--f-display);font-size:.92rem;font-weight:700;color:var(--tx-1)}
.sell-popup__tag{
  font-family:var(--f-mono);font-size:10px;font-weight:800;
  color:var(--c-down);text-transform:uppercase;letter-spacing:1.5px;
  background:rgba(37,99,235,.06);border:1px solid rgba(37,99,235,.12);
  padding:3px 10px;border-radius:4px;
}
.sell-popup__close{
  width:32px;height:32px;display:flex;align-items:center;justify-content:center;
  border-radius:6px;border:1px solid var(--b-default);
  background:transparent;color:var(--tx-3);cursor:pointer;
  font-size:1.1rem;transition:all .15s var(--ease);
}
.sell-popup__close:hover{background:var(--bg-hover);color:var(--tx-1);border-color:var(--b-strong)}
.sell-popup__body{
  padding:6px 22px 22px;
  max-height:calc(82vh - 70px);overflow-y:auto;
  scrollbar-width:thin;
}

.is-item{padding:12px 6px;border-bottom:1px solid var(--b-light);cursor:pointer;transition:all .2s var(--ease);border-radius:6px}
.is-item:last-child{border-bottom:none}
.is-item:hover{background:var(--c-accent-bg)}
.is-top{display:flex;align-items:center;gap:8px}
.is-rk{font-family:var(--f-mono);font-size:13px;font-weight:700;color:var(--tx-3);min-width:24px;text-align:center;font-variant-numeric:tabular-nums}
.is-nm{flex:1;min-width:0;font-size:.9rem;font-weight:600;color:var(--tx-1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.is-sc{font-family:var(--f-mono);font-size:.78rem;font-weight:700;padding:3px 8px;border-radius:4px;font-variant-numeric:tabular-nums}
.is-bot{display:flex;align-items:center;gap:10px;margin-top:6px;padding-left:32px}
.is-bar{flex:1;height:6px;background:var(--b-light);border-radius:3px;overflow:hidden}
.is-fill{height:100%;border-radius:3px;transition:width .6s ease-out}
.is-amt{font-family:var(--f-mono);font-size:.78rem;font-weight:600;color:var(--tx-2);min-width:48px;text-align:right;font-variant-numeric:tabular-nums}
.is-chg{font-family:var(--f-mono);font-size:.76rem;font-weight:600;min-width:44px;text-align:right;font-variant-numeric:tabular-nums}


/* ================================================================
   DAILY RADAR REPORT — Archive + Article
   ================================================================ */
.reports-sec{padding-bottom:60px}

.archive-chips{
  display:flex;gap:6px;flex-wrap:wrap;margin-bottom:20px;
  min-height:34px;align-items:center;
}
.archive-chip{
  font-family:var(--f-mono);font-size:.72rem;font-weight:600;
  color:var(--tx-3);background:var(--bg-card);
  border:1px solid var(--b-light);
  padding:5px 14px;border-radius:20px;cursor:pointer;
  transition:all .2s var(--ease);
}
.archive-chip:hover{color:var(--tx-2);border-color:var(--c-accent-border);background:var(--c-accent-bg)}
.archive-chip.active{color:var(--c-accent);border-color:var(--c-accent-border);background:var(--c-accent-bg);font-weight:700}
.archive-label{font-family:var(--f-mono);font-size:10px;font-weight:700;color:var(--tx-3);text-transform:uppercase;letter-spacing:1.5px;margin-right:6px}

.report-container{
  max-width:900px;margin:0 auto;
  background:var(--bg-card);border:1px solid var(--b-light);
  border-radius:var(--r-lg);
  box-shadow:var(--shadow-card);
  padding:44px 48px 48px;
  position:relative;overflow:hidden;
  animation:fadeUp .4s var(--ease);
}
.report-container::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,rgba(79,70,229,.12),rgba(79,70,229,.22),rgba(79,70,229,.12),transparent);
  background-size:200% 100%;animation:flowLine 4s ease-in-out infinite;
}
.report-loading{text-align:center;padding:48px;color:var(--tx-3);font-family:var(--f-mono);font-size:.82rem}
.report-empty{text-align:center;padding:64px 24px;color:var(--tx-3);font-family:var(--f-mono);font-size:.85rem}


/* ================================================================
   ARTICLE CONTENT CSS (ported from article_base)
   ================================================================ */
.article-hero{margin-bottom:28px;padding-bottom:28px;border-bottom:1px solid var(--border)}
.article-category{
  display:inline-flex;align-items:center;gap:6px;
  padding:4px 12px;border-radius:4px;
  font-family:var(--f-display);font-size:10px;font-weight:700;
  text-transform:uppercase;letter-spacing:1.2px;
  margin-bottom:18px;
}
.cat-radar{background:rgba(37,99,235,.06);color:#1E40AF;border:1px solid rgba(37,99,235,.15)}
.article-title{
  font-family:var(--f-display);
  font-size:1.85rem;font-weight:800;
  color:var(--tx-heading);
  line-height:1.28;letter-spacing:-.6px;
  margin-bottom:14px;
}
.article-subtitle{
  font-size:.95rem;color:var(--tx-secondary);
  line-height:1.65;margin-bottom:22px;
  font-weight:400;
}
.article-meta{
  display:flex;flex-wrap:wrap;gap:6px;align-items:center;
  padding-top:14px;border-top:1px solid var(--border);
}
.meta-item{
  display:inline-flex;align-items:center;gap:5px;
  padding:5px 12px;border-radius:6px;
  background:var(--bg-page);
  font-size:.72rem;color:var(--tx-secondary);
  font-family:var(--f-mono);font-weight:500;
  border:1px solid var(--border);
}
.meta-item .label{
  font-family:var(--f-display);color:var(--tx-muted);
  font-weight:700;text-transform:uppercase;font-size:8px;letter-spacing:.8px;
}
.impact-high{color:var(--accent-red);background:rgba(220,38,38,.05);border-color:rgba(220,38,38,.12)}
.impact-medium{color:var(--c-accent);background:var(--c-accent-bg);border-color:var(--c-accent-border)}
.impact-low{color:var(--accent-green);background:rgba(21,128,61,.05);border-color:rgba(21,128,61,.12)}

/* Article Divider */
.article-divider{height:1px;margin:32px 0;background:linear-gradient(90deg,var(--c-accent-border),var(--c-accent-border) 40%,transparent)}

/* Article Body */
.article-body h2{
  font-family:var(--f-display);
  font-size:1.25rem;font-weight:800;
  color:var(--tx-heading);
  margin:36px 0 16px;
  padding-bottom:10px;
  border-bottom:2px solid var(--c-accent-light);
  line-height:1.35;letter-spacing:-.3px;
}
.article-body h3{
  font-family:var(--f-display);
  font-size:1rem;font-weight:700;
  color:var(--tx-heading);
  margin:28px 0 12px;
  line-height:1.35;
}
.article-body p{margin:0 0 18px;line-height:1.85;color:var(--tx-body);font-size:.95rem}
.article-body strong{color:var(--tx-heading);font-weight:700}
.article-body ul,.article-body ol{margin:0 0 18px;padding-left:24px}
.article-body li{margin-bottom:10px;line-height:1.75}

/* Tables */
.tbl-wrap{
  overflow-x:auto;margin:20px 0 28px;
  border:1px solid var(--border);border-radius:var(--r-md);
  background:var(--bg-card);box-shadow:var(--s-sm);
}
.tbl{width:100%;border-collapse:collapse;font-size:.82rem}
.tbl thead{background:var(--bg-table-head)}
.tbl th{
  padding:13px 18px;text-align:left;
  font-family:var(--f-display);font-size:.68rem;font-weight:700;
  color:var(--tx-secondary);text-transform:uppercase;letter-spacing:1px;
  border-bottom:2px solid var(--border-strong);
}
.tbl td{padding:13px 18px;border-bottom:1px solid var(--border);color:var(--tx-body)}
.tbl tr:last-child td{border-bottom:none}
.tbl tr:nth-child(even){background:var(--bg-table-alt)}
.tbl tr:hover{background:rgba(79,70,229,.02)}
.tbl .highlight{color:var(--tx-heading);font-weight:700}
.tbl .up{color:var(--accent-red)}.tbl .dn{color:var(--accent-blue)}.tbl .gold{color:var(--c-accent)}

/* Blockquotes */
.bq{
  margin:28px 0;padding:22px 28px;
  border-left:3px solid var(--c-accent-light);
  background:rgba(79,70,229,.03);
  border-radius:0 var(--r-md) var(--r-md) 0;
  font-size:.9rem;line-height:1.85;color:var(--tx-body);
}
.bq strong{color:var(--c-accent)}
.bq-verdict{
  margin:28px 0;padding:28px 32px;
  background:linear-gradient(135deg,rgba(79,70,229,.04),transparent);
  border:1px solid var(--c-accent-border);
  border-radius:var(--r-lg);position:relative;
}
.bq-verdict::before{
  content:'VERDICT';position:absolute;top:-11px;left:24px;
  padding:3px 12px;background:var(--c-accent);color:var(--tx-inverse);
  font-family:var(--f-display);font-size:9px;font-weight:800;
  letter-spacing:1.5px;border-radius:4px;
}
.bq-verdict p{margin:0;line-height:1.85;color:var(--tx-heading);font-weight:500;font-size:.93rem}

/* Signal / Badge Tags */
.signal-grid{display:flex;flex-wrap:wrap;gap:8px;margin:16px 0}
.signal-tag{
  display:inline-flex;align-items:center;gap:6px;
  padding:6px 14px;border-radius:6px;
  font-family:var(--f-display);font-size:.75rem;font-weight:600;
  background:rgba(79,70,229,.03);border:1px solid var(--border);
}
.signal-bull{color:var(--accent-green);border-color:rgba(21,128,61,.2)}
.signal-bear{color:var(--accent-red);border-color:rgba(220,38,38,.2)}
.signal-mixed{color:var(--c-accent);border-color:var(--c-accent-border)}
.tag{display:inline-block;padding:3px 9px;border-radius:4px;font-family:var(--f-display);font-size:10px;font-weight:700;letter-spacing:.3px}
.tag-gold{background:var(--c-accent-bg);color:var(--c-accent-deep);border:1px solid var(--c-accent-border)}
.tag-red{background:rgba(220,38,38,.05);color:#B91C1C;border:1px solid rgba(220,38,38,.15)}
.tag-blue{background:rgba(29,78,216,.05);color:#1E40AF;border:1px solid rgba(29,78,216,.15)}
.tag-green{background:rgba(21,128,61,.05);color:#15803D;border:1px solid rgba(21,128,61,.15)}
.tag-purple{background:rgba(109,40,217,.05);color:#6D28D9;border:1px solid rgba(109,40,217,.15)}

/* Strategy Points */
.strategy-list{list-style:none;padding:0;margin:20px 0}
.strategy-list li{
  padding:14px 18px;margin-bottom:6px;
  background:var(--bg-page);border:1px solid var(--border);
  border-radius:var(--r-sm);font-size:.88rem;line-height:1.7;
  transition:all var(--transition-fast);
}
.strategy-list li:hover{border-color:var(--c-accent-border);box-shadow:var(--s-sm)}
.strategy-list li strong{color:var(--c-accent)}

/* Article Footer */
.article-footer{
  margin-top:44px;padding-top:22px;
  border-top:2px solid var(--border-strong);
  text-align:center;font-size:.73rem;color:var(--tx-muted);line-height:1.9;
}
.article-footer .powered{
  display:inline-flex;align-items:center;gap:6px;
  margin-top:8px;font-family:var(--f-display);font-weight:700;color:var(--tx-secondary);
}
.powered-icon{
  width:18px;height:18px;
  background:linear-gradient(135deg,var(--c-accent-deep),var(--c-accent));
  color:white;border-radius:3px;
  display:flex;align-items:center;justify-content:center;
  font-size:9px;font-weight:800;
}


/* ================================================================
   MODAL
   ================================================================ */
.modal-overlay{position:fixed;inset:0;background:rgba(26,31,46,.25);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;pointer-events:none;transition:opacity .25s;backdrop-filter:blur(6px)}
.modal-overlay.on{opacity:1;pointer-events:auto}
.modal-box{background:var(--bg-card);border:1px solid var(--b-light);border-radius:var(--r-xl);box-shadow:var(--s-xl),var(--s-glow);width:500px;max-width:92vw;max-height:85vh;overflow-y:auto;padding:30px 34px;animation:modalIn .3s var(--ease);position:relative}
.modal-box::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--c-accent-light),var(--c-accent),var(--c-accent-light),transparent);border-radius:var(--r-xl) var(--r-xl) 0 0}
@keyframes modalIn{from{opacity:0;transform:scale(.97) translateY(8px)}to{opacity:1;transform:scale(1) translateY(0)}}
.mo-hd{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:14px}
.mo-nm{font-family:var(--f-display);font-size:1.2rem;font-weight:700;color:var(--tx-1)}
.mo-cd{font-family:var(--f-mono);font-size:.78rem;color:var(--tx-3);margin-top:3px}
.mo-x{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:6px;border:1px solid var(--b-default);background:transparent;color:var(--tx-3);cursor:pointer;font-size:1.1rem;transition:all .15s var(--ease)}
.mo-x:hover{background:var(--bg-hover);color:var(--tx-1);border-color:var(--b-strong)}
.mo-div{height:1px;background:var(--b-light);margin-bottom:14px}
.mo-prc-row{display:flex;align-items:baseline;gap:12px;margin-bottom:18px}
.mo-prc{font-family:var(--f-mono);font-size:1.6rem;font-weight:800;color:var(--tx-1)}
.mo-prc-chg{font-family:var(--f-mono);font-size:.95rem;font-weight:600}
.mo-grid{display:grid;grid-template-columns:1fr 1fr;gap:5px 24px}
.mo-f{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--b-light)}
.mo-fl{font-family:var(--f-mono);font-size:.78rem;color:var(--tx-3)}
.mo-fv{font-family:var(--f-mono);font-size:.9rem;font-weight:600;color:var(--tx-1)}
.mo-loading{text-align:center;padding:36px 0;color:var(--tx-3);font-size:.82rem;font-family:var(--f-mono)}
.err-txt{color:var(--c-up);font-size:.8rem;text-align:center;padding:20px;font-family:var(--f-mono)}
.empty-txt{color:var(--tx-3);font-size:.8rem;text-align:center;padding:20px;font-family:var(--f-mono)}
.no-data{color:var(--tx-3);font-size:.78rem;text-align:center;padding:16px 12px;font-family:var(--f-mono);background:var(--bg-card-2);border:1px dashed var(--b-default);border-radius:var(--r-sm);letter-spacing:.3px}


/* ================================================================
   WATERMARK
   ================================================================ */
.watermark{position:fixed;bottom:16px;right:20px;display:flex;align-items:center;gap:6px;padding:6px 12px;background:rgba(255,255,255,.9);border:1px solid var(--b-light);border-radius:6px;box-shadow:var(--s-sm);font-family:var(--f-display);font-size:12px;font-weight:700;color:var(--tx-3);z-index:50;backdrop-filter:blur(8px)}
.wm-icon{width:18px;height:18px;background:linear-gradient(135deg,var(--c-accent-deep),var(--c-accent));color:white;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:800}


/* ================================================================
   ANIMATIONS
   ================================================================ */
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
@keyframes gaugeGrow{from{width:0}}
.flash-up{animation:flashR .5s ease}
.flash-down{animation:flashB .5s ease}
@keyframes flashR{0%,100%{background:transparent}30%{background:rgba(220,38,38,.05)}}
@keyframes flashB{0%,100%{background:transparent}30%{background:rgba(37,99,235,.05)}}


/* ================================================================
   DATA GUIDE — Slide-Down Panels
   ================================================================ */
.guide-btn{
  display:inline-flex;align-items:center;justify-content:center;
  width:20px;height:20px;border-radius:50%;
  background:var(--c-accent-bg2);border:1px solid var(--c-accent-border);
  color:var(--c-accent);font-family:var(--f-mono);font-size:10px;font-weight:700;
  cursor:pointer;transition:all .2s var(--ease);
  margin-left:6px;flex-shrink:0;line-height:1;
  opacity:.55;vertical-align:middle;
}
.guide-btn:hover{opacity:1;background:var(--c-accent);color:var(--tx-inv);transform:scale(1.1);box-shadow:0 0 8px rgba(79,70,229,.25)}
.guide-panel{
  max-height:0;overflow:hidden;opacity:0;
  transition:max-height .4s var(--ease),opacity .3s var(--ease),margin .3s var(--ease);
  margin:0;
}
.guide-panel.open{
  max-height:600px;opacity:1;margin:14px 0 6px;
}
.guide-inner{
  background:var(--bg-card-2);border-left:3px solid var(--c-accent);
  border-radius:0 var(--r-sm) var(--r-sm) 0;
  padding:18px 22px;
}
.guide-title{
  font-family:var(--f-mono);font-size:10px;font-weight:700;
  color:var(--c-accent);text-transform:uppercase;letter-spacing:1.5px;
  margin-bottom:8px;
}
.guide-text{
  font-family:var(--f-body);font-size:13px;color:var(--tx-2);
  line-height:1.8;word-break:keep-all;
}
.guide-text p{margin-bottom:8px}
.guide-text p:last-child{margin-bottom:0}
.guide-formula{
  display:inline;font-family:var(--f-mono);font-size:12px;font-weight:600;
  background:rgba(79,70,229,.06);color:var(--c-accent-deep);
  padding:2px 6px;border-radius:3px;
}
.guide-text ul{margin:6px 0 8px 16px;padding:0}
.guide-text li{margin-bottom:4px;font-size:12.5px}
.guide-text strong{color:var(--tx-1);font-weight:700}

/* ================================================================
   HONG SIGNAL RADAR — 수급 주도주 전략
   ================================================================ */
.signal-sec{padding:20px 0 10px}
.signal-card{
  background:var(--bg-card);border:1px solid var(--b-light);
  border-radius:var(--r-lg);overflow:hidden;
  position:relative;animation:fadeUp .35s var(--ease) backwards;
  box-shadow:var(--shadow-card);
}
.signal-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:3px;
  background:linear-gradient(90deg,#F59E0B,#EF4444,#8B5CF6,#4F46E5);
}
.signal-card__head{
  display:flex;align-items:center;justify-content:space-between;
  padding:16px 26px 14px;border-bottom:1px solid var(--b-light);
}
.signal-card__title{
  font-family:var(--f-mono);font-size:11px;font-weight:700;
  color:var(--tx-3);text-transform:uppercase;letter-spacing:1.8px;
  display:flex;align-items:center;gap:8px;
}
.signal-card__badge{
  font-family:var(--f-mono);font-size:9px;font-weight:800;
  padding:3px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:1px;
}
.signal-card__badge.live{background:rgba(5,150,105,.08);color:#059669;border:1px solid rgba(5,150,105,.15)}
.signal-card__badge.off{background:var(--bg-card-2);color:var(--tx-3);border:1px solid var(--b-light)}
.signal-card__right{display:flex;align-items:center;gap:8px}
.signal-card__time{
  font-family:var(--f-mono);font-size:.74rem;color:var(--tx-3);
  background:var(--bg-card-2);padding:4px 10px;border-radius:4px;
  border:1px solid var(--b-light);font-variant-numeric:tabular-nums;
}
.signal-card__body{
  display:grid;grid-template-columns:260px 1fr 1fr;gap:0;
  min-height:180px;
}
.signal-panel{padding:20px 24px;position:relative}
.signal-panel:not(:last-child){border-right:1px solid var(--b-light)}
.sp-label{
  font-family:var(--f-mono);font-size:10px;font-weight:700;
  color:var(--tx-3);text-transform:uppercase;letter-spacing:1.5px;
  margin-bottom:14px;display:flex;align-items:center;gap:6px;
}
.sp-trend{
  font-family:var(--f-display);font-size:1.15rem;font-weight:800;
  margin-bottom:10px;letter-spacing:-.3px;
}
.sp-trend.accel{color:#D97706}
.sp-trend.positive{color:#059669}
.sp-trend.flat{color:var(--tx-3)}
.sp-trend.negative{color:#DC2626}
.sp-trend.nodata{color:var(--tx-3)}
.sp-gauge-wrap{
  height:6px;background:var(--bg-card-2);border-radius:3px;
  overflow:hidden;margin-bottom:14px;border:1px solid var(--b-light);
}
.sp-gauge{height:100%;border-radius:3px;transition:width .8s cubic-bezier(.22,1,.36,1)}
.sp-gauge.accel{background:linear-gradient(90deg,#F59E0B,#EF4444)}
.sp-gauge.positive{background:linear-gradient(90deg,#10B981,#059669)}
.sp-gauge.flat{background:var(--tx-3)}
.sp-gauge.negative{background:linear-gradient(90deg,#EF4444,#DC2626)}
.sp-stats{display:flex;gap:20px}
.sp-stat{display:flex;flex-direction:column;gap:3px}
.sp-sl{font-family:var(--f-mono);font-size:9px;color:var(--tx-3);text-transform:uppercase;letter-spacing:.8px;font-weight:600}
.sp-sv{font-family:var(--f-mono);font-size:.88rem;font-weight:700;color:var(--tx-1);font-variant-numeric:tabular-nums}
.sp-sectors{display:flex;flex-direction:column;gap:6px;max-height:200px;overflow-y:auto;scrollbar-width:thin}
.sp-sector-tag{
  display:flex;align-items:center;gap:10px;
  padding:9px 14px;border-radius:var(--r-sm);
  background:var(--bg-card-2);border:1px solid var(--b-light);
  transition:all .2s var(--ease);cursor:default;
}
.sp-sector-tag:hover{border-color:var(--c-accent-border);background:var(--c-accent-bg)}
.sp-sector-nm{font-family:var(--f-body);font-size:.84rem;font-weight:600;color:var(--tx-1);flex:1}
.sp-sector-cnt{
  font-family:var(--f-mono);font-size:10px;font-weight:800;
  background:var(--c-accent);color:#fff;
  padding:2px 8px;border-radius:10px;min-width:22px;text-align:center;flex-shrink:0;
}
.sp-sector-stocks{
  font-family:var(--f-mono);font-size:.68rem;color:var(--tx-3);
  padding:0 14px 2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.sp-stocks{display:flex;flex-direction:column;gap:3px;max-height:200px;overflow-y:auto;scrollbar-width:thin}
.sp-stk{
  display:flex;align-items:center;gap:8px;
  padding:8px 12px;border-radius:6px;
  cursor:pointer;transition:all .2s var(--ease);
}
.sp-stk:hover{background:var(--c-accent-bg)}
.sp-lvl{
  font-family:var(--f-mono);font-size:8px;font-weight:800;
  padding:2px 6px;border-radius:3px;text-transform:uppercase;letter-spacing:.5px;
  flex-shrink:0;min-width:48px;text-align:center;
}
.sp-lvl.strong{background:rgba(245,158,11,.12);color:#B45309;border:1px solid rgba(245,158,11,.2)}
.sp-lvl.active{background:rgba(5,150,105,.08);color:#047857;border:1px solid rgba(5,150,105,.15)}
.sp-lvl.watch{background:var(--bg-card-2);color:var(--tx-3);border:1px solid var(--b-light)}
.sp-stk-nm{flex:1;font-size:.84rem;font-weight:600;color:var(--tx-1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sp-stk-sec{font-family:var(--f-mono);font-size:.68rem;color:var(--tx-3);flex-shrink:0}
.sp-stk-val{
  font-family:var(--f-mono);font-size:.76rem;font-weight:700;
  flex-shrink:0;min-width:42px;text-align:right;font-variant-numeric:tabular-nums;
}
.sp-stk-val.up{color:var(--c-up)}.sp-stk-val.dn{color:var(--c-down)}
@keyframes signalBlink{
  0%,100%{opacity:1;text-shadow:none}
  50%{opacity:.3;text-shadow:0 0 14px rgba(245,158,11,.7)}
}
.sp-stk.explosive{animation:signalBlink .7s ease-in-out infinite}
.sp-stk.explosive .sp-stk-nm{color:#B45309;font-weight:700}
.sp-empty{font-family:var(--f-mono);font-size:.78rem;color:var(--tx-3);text-align:center;padding:28px 12px}

@media(max-width:1024px){
  .signal-card__body{grid-template-columns:1fr;gap:0}
  .signal-panel:not(:last-child){border-right:none;border-bottom:1px solid var(--b-light)}
}


/* ================================================================
   STEALTH ACCUMULATION ZONE
   ================================================================ */
.stealth-zone{
  background:linear-gradient(135deg,#0F172A 0%,#1E293B 100%);
  border-radius:var(--r-lg);padding:26px;
  position:relative;overflow:hidden;
  animation:fadeUp .45s var(--ease) backwards;
}
.stealth-zone::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent,rgba(16,185,129,.2),rgba(16,185,129,.35),rgba(16,185,129,.2),transparent);
  background-size:200% 100%;animation:flowLine 4s ease-in-out infinite;
}
.stealth-zone:hover{box-shadow:0 8px 28px rgba(16,185,129,.06),0 2px 6px rgba(26,31,46,.04)}
.stealth-zone .sec-tag{color:#10B981}
.stealth-zone .sec-line{background:rgba(16,185,129,.18)}
.stealth-zone .card__head{
  padding:0 0 16px;margin-bottom:20px;
  border-bottom:1px solid rgba(255,255,255,.08);
}
.stealth-zone .card__title{color:#F1F5F9}
.stealth-zone .card__sub{color:#94A3B8;background:rgba(255,255,255,.04);border-color:rgba(255,255,255,.08)}
.stealth-zone .guide-btn{background:rgba(16,185,129,.15);border-color:rgba(16,185,129,.25);color:#10B981}
.stealth-zone .guide-btn:hover{background:#10B981;color:#0F172A}
.stealth-zone .guide-inner{background:rgba(255,255,255,.04);border-left-color:#10B981}
.stealth-zone .guide-title{color:#10B981}
.stealth-zone .guide-text{color:#94A3B8}
.stealth-zone .guide-text strong{color:#E2E8F0}
.stealth-zone .guide-formula{background:rgba(16,185,129,.1);color:#10B981}

/* ── Top 5 Cards ── */
.accum-cards{display:grid;grid-template-columns:repeat(5,1fr);gap:14px;margin-bottom:28px}
.accum-card{
  background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);
  border-radius:var(--r-md);padding:16px;cursor:pointer;
  transition:all .25s var(--ease);position:relative;overflow:hidden;
}
.accum-card:hover{background:rgba(255,255,255,.07);border-color:rgba(16,185,129,.25);transform:translateY(-2px)}
.accum-card[data-grade="S"]{border-color:rgba(245,158,11,.25)}
.accum-card[data-grade="S"]:hover{border-color:rgba(245,158,11,.45);box-shadow:0 4px 20px rgba(245,158,11,.1)}

.accum-card__hd{display:flex;align-items:center;gap:8px;margin-bottom:10px}
.accum-grade{
  font-family:var(--f-mono);font-size:11px;font-weight:800;
  padding:2px 8px;border-radius:4px;letter-spacing:.5px;
}
.accum-grade.grade-s{background:rgba(245,158,11,.15);color:#F59E0B}
.accum-grade.grade-a{background:rgba(16,185,129,.15);color:#10B981}
.accum-grade.grade-b{background:rgba(59,130,246,.15);color:#3B82F6}
.accum-grade.grade-c{background:rgba(107,114,128,.15);color:#6B7280}
.accum-grade.grade-d{background:rgba(107,114,128,.1);color:#4B5563}
.accum-card__nm{font-family:var(--f-body);font-size:.82rem;font-weight:600;color:#E2E8F0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}

.accum-card__score{font-family:var(--f-mono);font-size:1.6rem;font-weight:800;color:#F1F5F9;margin-bottom:4px;font-variant-numeric:tabular-nums}
.accum-card__score-lbl{font-family:var(--f-mono);font-size:.65rem;color:#64748B;text-transform:uppercase;letter-spacing:1px;margin-bottom:10px}

.accum-sparkline{display:block;width:100%;height:36px;margin-bottom:10px}
.accum-sparkline polyline{fill:none;stroke:#10B981;stroke-width:1.5;stroke-linejoin:round;stroke-linecap:round}
.accum-sparkline polygon{fill:rgba(16,185,129,0.1);stroke:none}
.mini-spark{display:inline-block;width:80px;height:24px;vertical-align:middle}
.mini-spark polyline{fill:none;stroke:#10B981;stroke-width:1;stroke-linejoin:round;stroke-linecap:round}
.mini-spark polygon{fill:rgba(16,185,129,0.08);stroke:none}

.accum-card__chg{display:flex;gap:12px;font-family:var(--f-mono);font-size:.72rem;margin-bottom:8px;font-variant-numeric:tabular-nums}
.accum-card__chg .lbl{color:#64748B;margin-right:2px}
.accum-card__chg .pos{color:#10B981}
.accum-card__chg .neg{color:#EF4444}

.accum-signal{
  font-family:var(--f-mono);font-size:.62rem;font-weight:700;
  text-transform:uppercase;letter-spacing:1px;
  padding:3px 8px;border-radius:3px;display:inline-block;
}
.accum-signal.stealth_conviction{background:rgba(245,158,11,.12);color:#F59E0B}
.accum-signal.active_accumulation{background:rgba(16,185,129,.12);color:#10B981}
.accum-signal.building_position{background:rgba(59,130,246,.12);color:#3B82F6}
.accum-signal.watching{background:rgba(107,114,128,.1);color:#6B7280}

/* ── Full Table ── */
.accum-tbl-wrap{overflow-x:auto}
.accum-tbl{width:100%;border-collapse:collapse;font-size:.82rem}
.accum-tbl th{
  font-family:var(--f-display);font-size:.68rem;font-weight:700;
  color:#64748B;text-transform:uppercase;letter-spacing:1px;
  padding:13px 12px;border-bottom:1px solid rgba(255,255,255,.08);
  text-align:left;white-space:nowrap;
}
.accum-tbl td{
  padding:13px 12px;border-bottom:1px solid rgba(255,255,255,.04);
  color:#CBD5E1;font-family:var(--f-mono);white-space:nowrap;
  vertical-align:middle;font-variant-numeric:tabular-nums;
}
.accum-tbl tr:last-child td{border-bottom:none}
.accum-tbl tr:nth-child(even) td{background:rgba(255,255,255,.015)}
.accum-tbl tr:hover td{background:rgba(255,255,255,.03)}
.accum-tbl .tbl-nm{font-family:var(--f-body);font-weight:500;color:#E2E8F0;cursor:pointer}
.accum-tbl .tbl-nm:hover{color:#10B981}
.accum-tbl .tbl-score{font-weight:700;color:#F1F5F9}
.accum-tbl .tbl-pos{color:#10B981}
.accum-tbl .tbl-neg{color:#EF4444}
.accum-tbl .tbl-zero{color:#64748B}

.stealth-empty{color:#64748B;text-align:center;padding:40px 0;font-family:var(--f-mono);font-size:.85rem}

/* ================================================================
   PROGRAM TRADING TOP
   ================================================================ */
.prog-tbl-wrap{overflow-x:auto}
.prog-tbl{width:100%;border-collapse:collapse;font-size:.82rem}
.prog-tbl thead{background:var(--bg-table-head)}
.prog-tbl th{
  font-family:var(--f-display);font-size:.68rem;font-weight:700;
  color:var(--tx-secondary);text-transform:uppercase;letter-spacing:1px;
  padding:13px 18px;border-bottom:2px solid var(--border-strong);
  text-align:left;white-space:nowrap;
}
.prog-tbl td{
  padding:13px 18px;border-bottom:1px solid var(--border);
  white-space:nowrap;vertical-align:middle;color:var(--tx-body);
}
.prog-tbl tr:last-child td{border-bottom:none}
.prog-tbl tr{cursor:pointer;transition:background .15s}
.prog-tbl tr:nth-child(even){background:var(--bg-table-alt)}
.prog-tbl tr:hover{background:rgba(79,70,229,.02)}
.prog-tbl .p-nm{font-weight:600;color:var(--tx-1)}
.prog-tbl .p-prc{font-family:var(--f-mono);color:var(--tx-2);font-variant-numeric:tabular-nums}
.prog-tbl .p-net{font-family:var(--f-mono);font-weight:600;font-variant-numeric:tabular-nums}
.prog-tbl .p-net.buy{color:var(--c-up)}
.prog-tbl .p-net.sell{color:var(--c-down)}
.prog-tbl .p-mkt{
  font-family:var(--f-mono);font-size:.65rem;font-weight:600;padding:2px 6px;border-radius:3px;
  letter-spacing:.3px;
}
.prog-tbl .p-mkt.kospi{background:rgba(79,70,229,.08);color:var(--c-accent)}
.prog-tbl .p-mkt.kosdaq{background:rgba(220,38,38,.06);color:#B91C1C}
.prog-toggle{
  display:block;width:100%;margin-top:14px;padding:10px;
  background:var(--bg-card-2);border:1px solid var(--b-light);border-radius:var(--r-sm);
  font-family:var(--f-mono);font-size:.78rem;font-weight:600;color:var(--tx-3);
  cursor:pointer;transition:all .2s var(--ease);text-align:center;
  text-transform:uppercase;letter-spacing:.5px;
}
.prog-toggle:hover{background:var(--bg-hover);color:var(--tx-2)}

/* ================================================================
   RESPONSIVE
   ================================================================ */
@media(max-width:1200px){
  .pulse-row{grid-template-columns:repeat(3,1fr)}
  .accum-cards{grid-template-columns:repeat(3,1fr)}
}
@media(max-width:1024px){
  .ib-cols{grid-template-columns:1fr}
  .ib-col:not(:last-child){border-right:none;border-bottom:1px solid var(--b-light)}
  .report-container{padding:28px 24px 32px}
  .accum-cards{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:768px){
  .content{padding:0 18px}
  .header{padding:0 18px}
  .foreign-grid{grid-template-columns:1fr}
  .foreign-list{max-height:320px}
  .pulse-row{grid-template-columns:1fr}
  .header__nav{gap:0}
  .nav-link{padding:6px 10px;font-size:.76rem}
  .report-container{padding:24px 18px 28px;border-radius:var(--r-md)}
  .article-title{font-size:1.4rem}
  .guide-inner{padding:14px 16px}
  .guide-text{font-size:12.5px}
  .accum-cards{grid-template-columns:1fr}
  .stealth-zone{padding:18px}
  .accum-tbl th,.accum-tbl td{padding:10px 8px}
  .prog-tbl th,.prog-tbl td{padding:10px 12px}
}
@media(max-width:480px){.header__nav{display:none}.header{height:52px}
  .accum-card__score{font-size:1.3rem}
}
</style>
</head>

<body>
<!-- HEADER -->
<header class="header">
  <div class="header__brand">
    <h1>AX RADAR</h1>
    <span class="ver">v5.2</span>
  </div>
  <nav class="header__nav">
    <a class="nav-link active" data-target="radar" onclick="navTo('radar')">Daily Radar</a>
  </nav>
  <div class="header__right">
    <span class="live-dot {{ 'on' if mode == 'LIVE' else 'off' }}">{{ mode }}</span>
    <span class="header__clock" id="clock">--:--:--</span>
  </div>
</header>

<div class="content">
  <div class="data-grid">

  <!-- ══ HONG SIGNAL RADAR ══ -->
  <section class="signal-sec">
    <div class="sec-label">
      <span class="sec-tag">HONG SIGNAL RADAR</span>
      <span class="sec-line"></span>
    </div>
    <div class="signal-card">
      <div class="signal-card__head">
        <div style="display:flex;align-items:center;gap:8px">
          <span class="signal-card__title">수급 주도주 전략</span>
          <span class="signal-card__badge off" id="signalBadge">--</span>
          <button class="guide-btn" onclick="toggleGuide('guide-hong')" title="전략 설명">?</button>
        </div>
        <span class="signal-card__time" id="signalTime">--:--:--</span>
      </div>
      <div class="guide-panel" id="guide-hong" style="margin:0 26px"><div class="guide-inner">
        <div class="guide-title">홍인기 수급 주도주 전략</div>
        <div class="guide-text">
          <p style="margin-bottom:12px"><strong>전략 개요</strong><br>
          9:30 이후 <span class="guide-formula">거래대금 상위 50종목(ka10032)</span>에서 같은 업종이 3개 이상 묶이는 <strong>주도 섹터</strong>를 찾습니다.<br>
          <span class="guide-formula">프로그램 매매 추이(ka90005)</span>의 기울기가 양전환&middot;가속하는지 확인하고,<br>
          <span class="guide-formula">기관 가집계(ka10065)</span>가 전 회차 대비 연속 증가하는 종목만 최종 시그널로 선별합니다.</p>
          <p style="margin-bottom:12px"><strong>시그널 레벨</strong><br>
          &nbsp;&nbsp;&middot; <strong style="color:#B45309">STRONG</strong> = 프로그램 가속 + 기관 증가 + 주도섹터<br>
          &nbsp;&nbsp;&middot; <strong style="color:#047857">ACTIVE</strong> = 프로그램 양전환 + 기관 증가 + 주도섹터<br>
          &nbsp;&nbsp;&middot; <strong style="color:var(--tx-3)">WATCH</strong> = 기관 증가 + 주도섹터 (프로그램 미확인)</p>
          <p><strong>깜빡임(Explosive)</strong>: 프로그램 가속 + 기관 가집계 5회 연속 증가 시 종목명이 점멸합니다.</p>
        </div>
      </div></div>
      <div class="signal-card__body">
        <div class="signal-panel">
          <div class="sp-label">Program Flow</div>
          <div class="sp-trend nodata" id="progTrend">LOADING</div>
          <div class="sp-gauge-wrap"><div class="sp-gauge" id="progGauge" style="width:0"></div></div>
          <div class="sp-stats">
            <div class="sp-stat"><span class="sp-sl">Slope</span><span class="sp-sv" id="progSlope">--</span></div>
            <div class="sp-stat"><span class="sp-sl">Cum Net</span><span class="sp-sv" id="progCumNet">--</span></div>
            <div class="sp-stat"><span class="sp-sl">Pts</span><span class="sp-sv" id="progPts">--</span></div>
          </div>
        </div>
        <div class="signal-panel">
          <div class="sp-label">Leading Sectors</div>
          <div class="sp-sectors" id="leadingSectors"><div class="sp-empty">Scanning...</div></div>
        </div>
        <div class="signal-panel">
          <div class="sp-label">Signal Stocks</div>
          <div class="sp-stocks" id="signalStocks"><div class="sp-empty">Scanning...</div></div>
        </div>
      </div>
    </div>
  </section>

  <!-- ══ MARKET PULSE ══ -->
  <section class="pulse-sec">
    <div class="sec-label"><span class="sec-tag">MARKET PULSE</span><span class="sec-line"></span></div>
    <div class="pulse-row">
      <div class="idx-card" id="idx-KOSPI" style="animation-delay:.1s">
        <div class="idx-lbl"><em class="idx-flag">&#x1F1F0;&#x1F1F7;</em> KOSPI</div>
        <div class="idx-val" id="idx-KOSPI-val">--</div>
        <div class="idx-chg fl" id="idx-KOSPI-chg">--</div>
      </div>
      <div class="idx-card" id="idx-KOSDAQ" style="animation-delay:.15s">
        <div class="idx-lbl"><em class="idx-flag">&#x1F1F0;&#x1F1F7;</em> KOSDAQ</div>
        <div class="idx-val" id="idx-KOSDAQ-val">--</div>
        <div class="idx-chg fl" id="idx-KOSDAQ-chg">--</div>
      </div>
      <div class="idx-card" id="idx-NASDAQ" style="animation-delay:.2s">
        <div class="idx-lbl"><em class="idx-flag">&#x1F1FA;&#x1F1F8;</em> NASDAQ</div>
        <div class="idx-val" id="idx-NASDAQ-val">--</div>
        <div class="idx-chg fl" id="idx-NASDAQ-chg">--</div>
      </div>
    </div>
  </section>

  <!-- ══ FOREIGN FLOW ══ -->
  <section class="flow-sec">
    <div class="sec-label"><span class="sec-tag">FOREIGN FLOW</span><span class="sec-line"></span></div>
    <div class="card" style="animation-delay:.2s">
      <div class="card__head">
        <span class="card__title">Foreign Flow</span><button class="guide-btn" onclick="toggleGuide('guide-foreign')" title="데이터 설명">?</button>
        <span class="card__sub">KOSPI &middot; 5~7영업일 누적</span>
      </div>
      <div class="guide-panel" id="guide-foreign" style="margin:0 26px"><div class="guide-inner">
        <div class="guide-title">Foreign Flow — 외국인 순매수/순매도 누적</div>
        <div class="guide-text">
          <p style="margin-bottom:12px"><strong>데이터 소스</strong><br>
          pykrx 라이브러리의 <span class="guide-formula">get_market_net_purchases_of_equities_by_ticker</span>를 호출합니다.<br>
          &nbsp;&nbsp;&middot; 조회 범위: 오늘 기준 <strong>최근 약 10일(달력일)</strong> — 주말&middot;공휴일 제외 실 영업일 기준 약 <strong>5~7영업일 누적</strong><br>
          &nbsp;&nbsp;&middot; 대상 시장: <strong>KOSPI</strong>, 투자자 구분: <strong>외국인</strong><br>
          &nbsp;&nbsp;&middot; 집계 방식: 해당 기간 전체의 <strong>순매수거래대금 누적 합산</strong></p>

          <p style="margin-bottom:12px"><strong>금액 산정</strong><br>
          pykrx가 반환하는 순매수거래대금의 원본 단위는 <span class="guide-formula">원(KRW)</span>입니다.<br>
          이를 &divide; 1억(100,000,000)으로 나누어 <span class="guide-formula">억원</span> 단위로 변환합니다.<br>
          &nbsp;&nbsp;&middot; 화면에 <strong>+1,200</strong> → 해당 종목을 최근 5~7영업일간 약 <strong>1,200억원</strong> 순매수했다는 의미</p>

          <p><strong>Net Buy TOP 20</strong>: 누적 순매수 금액 상위 20종목. 외국인이 지속적으로 사들이는 종목.</p>
          <p><strong>Net Sell TOP 20</strong>: 누적 순매도 금액 상위 20종목. 외국인이 지속적으로 팔고 있는 종목.</p>
          <p>종목 클릭 시 상세 팝업이 열립니다.</p>
        </div>
      </div></div>
      <div class="card__body foreign-grid">
        <div>
          <div class="foreign-hd buy">Net Buy TOP 20 <span class="fc-cnt" id="fbCnt"></span></div>
          <div class="foreign-list" id="foreignBuy"><div class="empty-txt">Loading...</div></div>
        </div>
        <div>
          <div class="foreign-hd sell">Net Sell TOP 20 <span class="fc-cnt" id="fsCnt"></span></div>
          <div class="foreign-list" id="foreignSell"><div class="empty-txt">Loading...</div></div>
        </div>
      </div>
    </div>
  </section>

  <!-- ══ SECTOR FLOW ══ -->
  <section class="flow-sec">
    <div class="sec-label"><span class="sec-tag">SECTOR FLOW</span><span class="sec-line"></span></div>
    <div class="card" style="animation-delay:.22s">
      <div class="card__head">
        <span class="card__title">Sector Flow</span><button class="guide-btn" onclick="toggleGuide('guide-sector')" title="데이터 설명">?</button>
        <div class="sector-tabs">
          <button class="sector-tab active" data-tab="foreign" onclick="switchSectorTab('foreign')">Foreign</button>
          <button class="sector-tab" data-tab="inst" onclick="switchSectorTab('inst')">Institution</button>
        </div>
        <span class="card__sub">KOSPI 18개 업종 &middot; ka10051</span>
      </div>
      <div class="guide-panel" id="guide-sector" style="margin:0 26px"><div class="guide-inner">
        <div class="guide-title">Sector Flow — 업종별 외국인/기관 순매수·순매도</div>
        <div class="guide-text">
          <p style="margin-bottom:12px"><strong>데이터 소스</strong><br>
          키움 REST API <span class="guide-formula">ka10051</span> (업종별투자자순매수요청)을 호출합니다.<br>
          &nbsp;&nbsp;&middot; 한 번의 호출로 KOSPI <strong>18개 산업 업종</strong>의 외국인·기관 순매수를 동시에 가져옵니다<br>
          &nbsp;&nbsp;&middot; <strong>Foreign</strong> 탭: <span class="guide-formula">frgnr_netprps</span> (외국인 순매수)<br>
          &nbsp;&nbsp;&middot; <strong>Institution</strong> 탭: <span class="guide-formula">orgn_netprps</span> (기관 합산 순매수)</p>

          <p style="margin-bottom:12px"><strong>차트 읽는 법</strong><br>
          &nbsp;&nbsp;&middot; <strong style="color:var(--c-up)">우측 빨간 바</strong> = 순매수 업종 (자금 유입)<br>
          &nbsp;&nbsp;&middot; <strong style="color:var(--c-down)">좌측 파란 바</strong> = 순매도 업종 (자금 유출)<br>
          &nbsp;&nbsp;&middot; 바 길이는 최대값 대비 상대 비율</p>

          <p><strong>활용</strong>: 외국인/기관 자금이 어느 업종에 몰리고 빠지는지 한눈에 파악하여 <strong>섹터 로테이션</strong>을 읽을 수 있습니다.</p>
        </div>
      </div></div>
      <div class="card__body">
        <div class="sector-chart" id="sectorChart"><div class="empty-txt">Loading...</div></div>
      </div>
    </div>
  </section>

  <!-- ══ IB SECTOR FLOW ══ -->
  <section class="flow-sec">
    <div class="sec-label"><span class="sec-tag">SECTOR FLOW BY IB</span><span class="sec-line"></span></div>
    <div class="card" style="animation-delay:.23s">
      <div class="card__head">
        <span class="card__title">IB Sector Flow</span><button class="guide-btn" onclick="toggleGuide('guide-ibsector')" title="데이터 설명">?</button>
        <span class="card__sub">MS &middot; JP &middot; GS &middot; TOP 종목 업종 합산</span>
      </div>
      <div class="guide-panel" id="guide-ibsector" style="margin:0 26px"><div class="guide-inner">
        <div class="guide-title">IB Sector Flow — 외국계 IB별 업종 분포</div>
        <div class="guide-text">
          <p style="margin-bottom:12px"><strong>데이터 소스</strong><br>
          <span class="guide-formula">ka10039</span> (회원사별매매상위종목)의 순매수/순매도 TOP 20 종목을<br>
          <span class="guide-formula">ka20002</span> (업종별종목)로 업종 매핑한 뒤 업종별로 합산합니다.<br>
          &nbsp;&nbsp;&middot; 각 기관의 5영업일 누적 순매수 TOP 20 + 순매도 TOP 20을 업종별로 집계<br>
          &nbsp;&nbsp;&middot; 순매수 종목 금액은 (+), 순매도 종목 금액은 (-)로 상계</p>

          <p style="margin-bottom:12px"><strong>차트 읽는 법</strong><br>
          &nbsp;&nbsp;&middot; <strong style="color:var(--c-up)">우측 빨간 바</strong> = 해당 IB가 순매수 우위인 업종<br>
          &nbsp;&nbsp;&middot; <strong style="color:var(--c-down)">좌측 파란 바</strong> = 해당 IB가 순매도 우위인 업종</p>

          <p><strong>주의</strong>: TOP 20 종목 기반이므로 전체 매매를 완전히 반영하지는 않으나, 주요 포지션의 업종 편향을 파악할 수 있습니다.</p>
        </div>
      </div></div>
      <div class="ib-sector-cols">
        <div class="ib-sector-col">
          <div class="ib-sector-col-hd"><div class="ib-col-logo ms">MS</div><div class="ib-col-nm">Morgan Stanley</div></div>
          <div class="ib-sector-chart" id="ibSector-MS"><div class="empty-txt">Loading...</div></div>
        </div>
        <div class="ib-sector-col">
          <div class="ib-sector-col-hd"><div class="ib-col-logo jp">JP</div><div class="ib-col-nm">JP Morgan</div></div>
          <div class="ib-sector-chart" id="ibSector-JP"><div class="empty-txt">Loading...</div></div>
        </div>
        <div class="ib-sector-col">
          <div class="ib-sector-col-hd"><div class="ib-col-logo gs">GS</div><div class="ib-col-nm">Goldman Sachs</div></div>
          <div class="ib-sector-chart" id="ibSector-GS"><div class="empty-txt">Loading...</div></div>
        </div>
      </div>
    </div>
  </section>

  <!-- ══ INSTITUTION DESK ══ -->
  <section class="flow-sec ib-section">
    <div class="sec-label"><span class="sec-tag">INSTITUTION DESK</span><span class="sec-line"></span></div>
    <div class="card" style="animation-delay:.25s">
      <div class="card__head">
        <span class="card__title">Institution Desk</span><button class="guide-btn" onclick="toggleGuide('guide-inst')" title="데이터 설명">?</button>
        <span class="card__sub">MS &middot; JP &middot; GS &middot; 5영업일 누적</span>
      </div>
      <div class="guide-panel" id="guide-inst" style="margin:0 26px"><div class="guide-inner">
        <div class="guide-title">Institution Desk — 외국계 IB 5일 순매수/순매도</div>
        <div class="guide-text">
          <p style="margin-bottom:12px"><strong>왜 이 3개 기관인가?</strong><br>
          Morgan Stanley(회원사 036), JP Morgan(033), Goldman Sachs(045)는 한국 시장에서 가장 활발하게 직접 매매하는 글로벌 투자은행입니다. 이들의 자기자본 매매(Proprietary Trading)는 대형 기관 전략을 반영하며, 단순 위탁 매매와 달리 자체 투자 판단이 담긴 매수 신호로 해석됩니다.</p>

          <p style="margin-bottom:12px"><strong>데이터 수집</strong><br>
          키움증권 REST API <span class="guide-formula">ka10039</span> (회원사별 종목 매매순위)를 호출합니다.<br>
          &nbsp;&nbsp;&middot; 요청: 회원사 코드(mmcm_cd) + <strong>5영업일</strong>(dt=5) + 매수(trde_tp=1) / 매도(trde_tp=2)<br>
          &nbsp;&nbsp;&middot; 응답: 종목코드, 종목명, 순매수대금(netprps_amt), 등락률<br>
          &nbsp;&nbsp;&middot; 각 기관별 순매수/순매도 금액이 큰 순서대로 최대 20종목을 표시합니다.</p>

          <p style="margin-bottom:12px"><strong>금액</strong><br>
          netprps_amt의 원본 단위는 <span class="guide-formula">천원</span>이며, &divide;100,000 하여 <span class="guide-formula">억원</span>으로 표시합니다.<br>
          &nbsp;&nbsp;&middot; <strong>+181억</strong> → 해당 기관이 5영업일간 약 181억원 순매수<br>
          &nbsp;&nbsp;&middot; 금액은 5일간 누적 순매수대금 (매수총액 − 매도총액)</p>

          <p><strong>바 차트</strong>: 각 기관 내 1위 대비 상대 비중을 시각화합니다.<br>
          &nbsp;&nbsp;&middot; <strong style="color:var(--c-up)">빨간색 바</strong> = 해당 종목 주가 상승 중 (매수 + 주가↑)<br>
          &nbsp;&nbsp;&middot; <strong style="color:var(--c-down)">파란색 바</strong> = 해당 종목 주가 하락 중 (매수 + 주가↓ = 저점 매집 가능성)</p>
          <p>종목을 클릭하면 현재가&middot;등락률&middot;시가총액 등 상세 팝업을 볼 수 있습니다.</p>
        </div>
      </div></div>
      <div class="ib-cols">
        <div class="ib-col">
          <div class="ib-col-hd"><div class="ib-col-logo ms">MS</div><div><div class="ib-col-nm">Morgan Stanley</div><div class="ib-col-cd">036</div></div></div>
          <div class="ib-col-list" id="MS-col"></div>
        </div>
        <div class="ib-col">
          <div class="ib-col-hd"><div class="ib-col-logo jp">JP</div><div><div class="ib-col-nm">JP Morgan</div><div class="ib-col-cd">033</div></div></div>
          <div class="ib-col-list" id="JP-col"></div>
        </div>
        <div class="ib-col">
          <div class="ib-col-hd"><div class="ib-col-logo gs">GS</div><div><div class="ib-col-nm">Goldman Sachs</div><div class="ib-col-cd">045</div></div></div>
          <div class="ib-col-list" id="GS-col"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- ══ STEALTH ACCUMULATION ══ -->
  <section class="flow-sec">
    <div class="sec-label"><span class="sec-tag">STEALTH ACCUMULATION</span><span class="sec-line"></span></div>
    <div class="stealth-zone" style="animation-delay:.28s">
      <div class="card__head">
        <div style="display:flex;align-items:center;gap:8px">
          <span class="card__title">Foreign Accumulation Radar</span>
          <button class="guide-btn" onclick="toggleGuide('guide-accum')" title="데이터 설명">?</button>
        </div>
        <span class="card__sub">외국인 스텔스 축적 &middot; 2분 갱신</span>
      </div>
      <div class="guide-panel" id="guide-accum" style="margin:0"><div class="guide-inner">
        <div class="guide-title">Foreign Accumulation Radar — 외국인 스텔스 축적 스캐너</div>
        <div class="guide-text">
          <p style="margin-bottom:12px"><strong>전략 개요</strong><br>
          외국인 한도소진율이 급증하면서 조용히 지분을 늘리고 있는 종목을 포착합니다.<br>
          <span class="guide-formula">ka10036</span>(한도소진율증가상위) &rarr; <span class="guide-formula">ka10008</span>(외국인비중시계열) &rarr; <span class="guide-formula">ka10034</span>(기간별매매순위) 3개 API를 교차 분석합니다.</p>
          <p style="margin-bottom:12px"><strong>Accumulation Score (0~100)</strong><br>
          &nbsp;&nbsp;&middot; <strong>비중변화(30)</strong>: 5/20일 외국인 비중 증감<br>
          &nbsp;&nbsp;&middot; <strong>소진율(25)</strong>: 한도소진율 상승폭<br>
          &nbsp;&nbsp;&middot; <strong>연속매수(20)</strong>: 외국인 연속 순매수 일수<br>
          &nbsp;&nbsp;&middot; <strong>순위(15)</strong>: 기간별 순매수 순위<br>
          &nbsp;&nbsp;&middot; <strong>거래비중(10)</strong>: 외국인 거래량 점유율</p>
          <p><strong>Grade</strong>: S(80+) &middot; A(60+) &middot; B(40+) &middot; C(20+) &middot; D(&lt;20)</p>
        </div>
      </div></div>
      <div id="accumCards" class="accum-cards"><div class="stealth-empty">Loading...</div></div>
      <div class="accum-tbl-wrap">
        <table class="accum-tbl">
          <thead>
            <tr>
              <th>#</th>
              <th>종목</th>
              <th>Score</th>
              <th>Grade</th>
              <th>비중(현재)</th>
              <th>5D</th>
              <th>20D</th>
              <th>소진율↑</th>
              <th>연속매수</th>
              <th>추이</th>
              <th>Signal</th>
            </tr>
          </thead>
          <tbody id="accumTable"><tr><td colspan="11" class="stealth-empty">Loading...</td></tr></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- ══ PROGRAM TRADING TOP ══ -->
  <section class="flow-sec">
    <div class="sec-label"><span class="sec-tag">PROGRAM TRADING</span><span class="sec-line"></span></div>
    <div class="card" style="animation-delay:.3s">
      <div class="card__head">
        <div style="display:flex;align-items:center;gap:8px">
          <span class="card__title">Program Trading TOP</span>
          <button class="guide-btn" onclick="toggleGuide('guide-prog')" title="데이터 설명">?</button>
        </div>
        <span class="card__sub">당일 프로그램 순매수 상위 &middot; KOSPI + KOSDAQ</span>
      </div>
      <div class="guide-panel" id="guide-prog" style="margin:0 26px"><div class="guide-inner">
        <div class="guide-title">Program Trading TOP — 당일 프로그램 순매수 상위</div>
        <div class="guide-text">
          <p style="margin-bottom:12px"><strong>데이터 소스</strong><br>
          키움 REST API <span class="guide-formula">ka90003</span> (프로그램순매수상위50요청)을 코스피/코스닥 각각 호출 후 통합합니다.<br>
          &nbsp;&nbsp;&middot; 프로그램 매매 = 기관의 알고리즘 자동매매<br>
          &nbsp;&nbsp;&middot; 순매수금액(prm_netprps_amt) 절대값 기준 내림차순 정렬</p>
          <p><strong>활용</strong>: 프로그램 매매가 집중되는 종목은 기관 수급이 유입되고 있는 신호입니다. 외국인/기관 데이터와 교차 확인하면 수급 방향성을 파악할 수 있습니다.</p>
        </div>
      </div></div>
      <div class="card__body">
      <div class="prog-tbl-wrap">
        <table class="prog-tbl">
          <thead>
            <tr>
              <th>#</th>
              <th>종목</th>
              <th>시장</th>
              <th>현재가</th>
              <th>등락률</th>
              <th>프로그램 순매수</th>
            </tr>
          </thead>
          <tbody id="progBody"><tr><td colspan="6" style="text-align:center;color:var(--tx-3);padding:32px">Loading...</td></tr></tbody>
        </table>
      </div>
      <button class="prog-toggle" id="progToggle" style="display:none" onclick="toggleProg()">더보기 ▼</button>
      </div><!-- .card__body -->
    </div>
  </section>

  <!-- ══ DAILY RADAR REPORT ══ -->
  <section class="reports-sec" id="reports">
    <div class="sec-label"><span class="sec-tag">DAILY RADAR</span><span class="sec-line"></span></div>
    <div class="archive-chips" id="archiveChips">
      <span class="archive-label">Archive</span>
    </div>
    <div class="report-container" id="reportContainer">
      <div class="report-loading">Loading report...</div>
    </div>
  </section>

  </div><!-- .data-grid -->
</div>

<div class="watermark"><div class="wm-icon">M</div>Muze AI</div>

<!-- ═══ SELL POPUP ═══ -->
<div class="sell-popup-overlay" id="sellOverlay">
  <div class="sell-popup">
    <div class="sell-popup__head">
      <div class="sell-popup__title">
        <div class="sell-popup__logo" id="sellPopLogo"></div>
        <span class="sell-popup__nm" id="sellPopNm"></span>
        <span class="sell-popup__tag">NET SELL TOP 20</span>
      </div>
      <button class="sell-popup__close" id="sellPopClose">&times;</button>
    </div>
    <div class="sell-popup__body" id="sellPopBody"></div>
  </div>
</div>

<div class="modal-overlay" id="mo">
  <div class="modal-box">
    <div class="mo-hd">
      <div><div class="mo-nm" id="mo-nm"></div><div class="mo-cd" id="mo-cd"></div></div>
      <button class="mo-x" id="mo-x">&times;</button>
    </div>
    <div class="mo-div"></div>
    <div id="mo-bd"></div>
  </div>
</div>
<script>

/* ═══════════════ Data Guide Toggle ═══════════════ */
function toggleGuide(id){
  var panel=document.getElementById(id);
  if(!panel)return;
  document.querySelectorAll('.guide-panel.open').forEach(function(p){
    if(p.id!==id)p.classList.remove('open');
  });
  panel.classList.toggle('open');
}

/* ═══════════════════════════════════════════════════════
   AX RADAR v5.2 — Daily Radar Engine
   ═══════════════════════════════════════════════════════ */
(function(){
'use strict';

const REFRESH = {{ refresh_interval }};
let timer = null;

/* ── Report State ── */
const reportCache = {};
let currentDate = null;

/* ── Sector Tab State ── */
let sectorTabMode = 'foreign'; // 'foreign' | 'inst'
let sectorFlowData = null;

/* ── API Layer ── */
const API = {
  _cache: {},
  async _f(url, retries=1){
    for(let i=0;i<=retries;i++){
      try{
        if(i>0) await new Promise(r=>setTimeout(r,1000));
        const r=await fetch(url);
        if(!r.ok){if(i<retries)continue;throw new Error('HTTP '+r.status)}
        const j=await r.json();
        if(j.status!=='ok'){if(i<retries)continue;throw new Error(j.message||'API error')}
        this._cache[url]=j.data;
        return j.data;
      }catch(e){
        if(i>=retries){if(this._cache[url])return this._cache[url];throw e}
      }
    }
  },
  indices()    {return this._f('/api/v3/indices')},
  inst()       {return this._f('/api/v3/institutions')},
  stock(c)     {return this._f('/api/v3/stock/'+c)},
  foreignTop() {return this._f('/api/v3/foreign-top')},
  foreignSector(){return this._f('/api/v3/foreign-sector')},
  ibSector(){return this._f('/api/v3/ib-sector')},
  hongSignal(m){return this._f('/api/v4/strategy/signals'+(m?'?market='+m:''))},
  accumulation(){return this._f('/api/v3/accumulation')},
  programTop(){return this._f('/api/v3/program-top')},
  article(cat,date){
    let url='/api/v3/article/'+cat;
    if(date)url+='?date='+encodeURIComponent(date);
    return this._f(url);
  },
};

/* ── Init ── */
document.addEventListener('DOMContentLoaded',()=>{
  loadAll();
  timer=setInterval(loadAll,REFRESH);
  document.getElementById('mo').addEventListener('click',e=>{if(e.target.id==='mo')closeMo()});
  document.getElementById('mo-x').addEventListener('click',closeMo);
  document.getElementById('sellOverlay').addEventListener('click',e=>{if(e.target.id==='sellOverlay')closeSellPopup()});
  document.getElementById('sellPopClose').addEventListener('click',closeSellPopup);
  document.addEventListener('keydown',e=>{if(e.key==='Escape'){closeMo();closeSellPopup()}});
  /* Auto-load Daily Radar report */
  setTimeout(function(){loadReport('radar')},500);
});

function loadAll(){
  clock();
  loadIdx();
  loadForeignTop();
  loadSectorFlow();
  loadIbSector();
  loadInst();
  loadHongSignal();
  loadAccumulation();
  loadProgramTop();
}

function clock(){
  const d=new Date(),p=n=>String(n).padStart(2,'0');
  const el=document.getElementById('clock');
  if(el) el.textContent=p(d.getHours())+':'+p(d.getMinutes())+':'+p(d.getSeconds());
}

/* ── Formatting ── */
function fNum(n){if(n==null)return'-';return Number(n).toLocaleString('ko-KR')}
function fAmt(n){
  if(!n)return'0';
  const a=Math.abs(n),s=n<0?'-':'+';
  if(a>=10000)return s+(a/10000).toFixed(1)+'\uC870';
  if(a>=1)return s+Math.round(a).toLocaleString('ko-KR')+'\uC5B5';
  return s+(a*1000).toFixed(0)+'\uBC31\uB9CC';
}
function fCap(n){
  if(!n)return'-';
  const a=Math.abs(n);
  if(a>=10000)return(a/10000).toFixed(1)+'\uC870';
  return a.toLocaleString('ko-KR')+'\uC5B5';
}
function sigCls(sig){const s=String(sig);return['1','2'].includes(s)?'up':['4','5'].includes(s)?'dn':'fl'}
function sigArrow(sig){const s=String(sig);return['1','2'].includes(s)?'\u25B2':['4','5'].includes(s)?'\u25BC':''}


/* ═══════════════ Navigation ═══════════════ */
window.navTo=function(target){
  if(target==='radar'){
    document.getElementById('reports').scrollIntoView({behavior:'smooth'});
  }
};


/* ═══════════════ Market Pulse — Indices ═══════════════ */
async function loadIdx(){
  try{
    const d=await API.indices();
    ['KOSPI','KOSDAQ','NASDAQ'].forEach(k=>{
      const idx=d[k];
      if(!idx)return;
      const valEl=document.getElementById('idx-'+k+'-val');
      const chgEl=document.getElementById('idx-'+k+'-chg');
      if(!valEl||!chgEl)return;

      const val=idx.value||0;
      const chg=idx.change||0;
      const pct=idx.changePct||0;
      const cls=sigCls(idx.signal);
      const arrow=sigArrow(idx.signal);

      valEl.textContent=val.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
      chgEl.className='idx-chg '+cls;
      chgEl.textContent=arrow+' '+(chg>0?'+':'')+chg.toFixed(2)+' ('+(pct>0?'+':'')+pct.toFixed(2)+'%)';
    });
  }catch(e){
    console.error('loadIdx',e);
  }
}


/* ═══════════════ Reports — Radar Only ═══════════════ */
window.switchReport=function(cat,date){
  currentDate=date||null;
  loadReport(cat,date);
};

async function loadReport(cat,date){
  const container=document.getElementById('reportContainer');
  const cacheKey=cat+'|'+(date||'latest');

  if(reportCache[cacheKey]){
    renderReport(reportCache[cacheKey],cat);
    return;
  }

  container.innerHTML='<div class="report-loading">Loading report...</div>';

  try{
    const data=await API.article(cat,date);
    reportCache[cacheKey]=data;
    renderReport(data,cat);
  }catch(e){
    console.error('report',e);
    container.innerHTML='<div class="report-empty">No report available.</div>';
    renderArchive([]);
  }
}

function renderReport(data,cat){
  const container=document.getElementById('reportContainer');
  const meta=data.meta||{};
  const body=data.body||'';

  let heroHtml='<div class="article-hero">';
  heroHtml+='<div class="article-category cat-radar">Daily Radar</div>';
  heroHtml+='<h1 class="article-title">'+(meta.title||'Untitled')+'</h1>';
  if(meta.subtitle) heroHtml+='<p class="article-subtitle">'+meta.subtitle+'</p>';

  heroHtml+='<div class="article-meta">';
  if(meta.date) heroHtml+='<div class="meta-item"><span class="label">Date</span> '+meta.date+'</div>';
  if(meta.sentiment) heroHtml+='<div class="meta-item impact-medium"><span class="label">Sentiment</span> '+meta.sentiment+'</div>';
  if(meta.conviction_score) heroHtml+='<div class="meta-item"><span class="label">Conviction</span> <strong style="color:var(--accent-gold)">'+meta.conviction_score+'</strong></div>';
  heroHtml+='</div>';
  heroHtml+='</div>';

  let footerHtml='<div class="article-footer">';
  if(meta.footer_text) footerHtml+='<div>'+meta.footer_text+'</div>';
  footerHtml+='<div>데이터 기준: '+(meta.date||'')+' 장중</div>';
  footerHtml+='<div class="powered"><div class="powered-icon">M</div> Powered by Muze AI</div>';
  footerHtml+='</div>';

  container.innerHTML=heroHtml
    +'<div class="article-divider"></div>'
    +'<div class="article-body">'+body+'</div>'
    +footerHtml;

  /* Render archive chips */
  renderArchive(data.sidebar||[]);
}

function renderArchive(sidebar){
  const el=document.getElementById('archiveChips');
  let html='<span class="archive-label">Archive</span>';
  if(!sidebar||!sidebar.length){
    el.innerHTML=html+'<span style="font-size:.75rem;color:var(--tx-3)">No articles</span>';
    return;
  }
  sidebar.forEach(function(s){
    const isActive=(s.date_slug===currentDate)||(currentDate===null&&sidebar[0].date_slug===s.date_slug);
    html+='<span class="archive-chip'+(isActive?' active':'')+'" onclick="switchReport(\'radar\',\''+s.date_slug+'\')">'
      +s.date+'</span>';
  });
  el.innerHTML=html;
}


/* ═══════════════ Foreign Flow TOP 20 ═══════════════ */
async function loadForeignTop(){
  try{
    const d=await API.foreignTop();
    const buyList=(d.buy||[]).slice(0,20);
    const sellList=(d.sell||[]).slice(0,20);
    rForeignList('foreignBuy',buyList,'buy');
    rForeignList('foreignSell',sellList,'sell');
    const bc=document.getElementById('fbCnt');
    const sc=document.getElementById('fsCnt');
    if(bc)bc.textContent=buyList.length+' stocks';
    if(sc)sc.textContent=sellList.length+' stocks';
  }catch(e){
    console.error('foreignTop',e);
    const fb=document.getElementById('foreignBuy');
    const fs=document.getElementById('foreignSell');
    if(fb)fb.innerHTML='<div class="no-data">데이터를 불러올 수 없습니다</div>';
    if(fs)fs.innerHTML='<div class="no-data">데이터를 불러올 수 없습니다</div>';
  }
}
function rForeignList(id,items,type){
  const el=document.getElementById(id);if(!el)return;
  if(!items.length){el.innerHTML='<div class="empty-txt">No data</div>';return}
  /* 1위 금액 = 바 100%, 나머지는 비례 */
  const maxAmt=Math.abs(items[0].amount)||1;
  const clr=type==='buy'?'220,38,38':'37,99,235';
  el.innerHTML=items.map((s,i)=>{
    const a=Math.abs(s.amount);
    const v=a>=10000?(a/10000).toFixed(1)+'\uC870':a.toLocaleString('ko-KR')+'\uC5B5';
    const pfx=type==='buy'?'+':'-';
    const rkCls=i===0?'fi-rk-1':i===1?'fi-rk-2':i===2?'fi-rk-3':'';
    const p=s.changePct||0;
    const pc=p>0?'up':p<0?'dn':'fl';
    const chgStr=(p>0?'+':'')+p.toFixed(1)+'%';
    const barPct=Math.min(100,Math.round(a/maxAmt*100));
    return'<div class="fi-item" onclick="openMo(\''+s.code+'\')">'
      +'<span class="fi-rk '+rkCls+'">'+(i+1)+'</span>'
      +'<span class="fi-nm">'+s.name+'</span>'
      +'<span class="fi-bar-wrap"><span class="fi-fill" style="width:'+barPct+'%;background:rgb('+clr+')"></span></span>'
      +'<span class="fi-chg '+pc+'">'+chgStr+'</span>'
      +'<span class="fi-amt '+type+'">'+pfx+v+'</span>'
    +'</div>';
  }).join('');
}


/* ═══════════════ Sector Flow — Diverging Bar Chart (tabbed) ═══════════════ */
window.switchSectorTab=function(mode){
  sectorTabMode=mode;
  document.querySelectorAll('.sector-tab').forEach(function(t){
    t.classList.toggle('active',t.getAttribute('data-tab')===mode);
  });
  if(sectorFlowData) renderSectorChart(sectorFlowData);
};

async function loadSectorFlow(){
  try{
    const d=await API.foreignSector();
    sectorFlowData=d||[];
    renderSectorChart(sectorFlowData);
  }catch(e){
    console.error('sectorFlow',e);
    const el=document.getElementById('sectorChart');
    if(el)el.innerHTML='<div class="no-data">데이터를 불러올 수 없습니다</div>';
  }
}
function renderSectorChart(items){
  const el=document.getElementById('sectorChart');
  if(!el)return;
  if(!items.length){el.innerHTML='<div class="empty-txt">No data</div>';return}

  /* Pick amount field based on tab */
  const isForeign=sectorTabMode==='foreign';
  const amtKey=isForeign?'foreignAmt':'instAmt';
  const label=isForeign?'Foreign':'Institution';

  /* Sort by selected amount */
  const sorted=items.slice().sort(function(a,b){return (b[amtKey]||0)-(a[amtKey]||0)});
  const maxAmt=Math.max(...sorted.map(function(s){return Math.abs(s[amtKey]||0)}))||1;

  let html='';
  /* Header row */
  html+='<div class="sector-header-row">';
  html+='<div class="sector-nm">업종</div>';
  html+='<div class="sector-bar-wrap">';
  html+='<div class="sector-bar-left">\u25C0 NET SELL</div>';
  html+='<div class="sector-axis"></div>';
  html+='<div class="sector-bar-right">NET BUY \u25B6</div>';
  html+='</div>';
  html+='<div class="sector-amt">금액</div>';
  html+='</div>';

  sorted.forEach(function(s){
    const amt=s[amtKey]||0;
    const pct=Math.round(Math.abs(amt)/maxAmt*100);
    const isBuy=amt>0;
    const isZero=amt===0;
    const cls=isZero?'zero':(isBuy?'buy':'sell');
    const sign=isBuy?'+':'';
    const absAmt=Math.abs(amt);
    const dispAmt=absAmt>=10000?(absAmt/10000).toFixed(1)+'\uC870':absAmt.toLocaleString('ko-KR')+'\uC5B5';

    html+='<div class="sector-row">';
    html+='<div class="sector-nm">'+s.sector+'</div>';
    html+='<div class="sector-bar-wrap">';
    html+='<div class="sector-bar-left">';
    if(!isBuy&&!isZero) html+='<div class="sector-bar sell" style="width:'+pct+'%"></div>';
    html+='</div>';
    html+='<div class="sector-axis"></div>';
    html+='<div class="sector-bar-right">';
    if(isBuy) html+='<div class="sector-bar buy" style="width:'+pct+'%"></div>';
    html+='</div>';
    html+='</div>';
    html+='<div class="sector-amt '+cls+'">'+sign+dispAmt+'</div>';
    html+='</div>';
  });

  el.innerHTML=html;
}

/* ═══════════════ IB Sector Flow — Diverging Bar Chart per IB ═══════════════ */
async function loadIbSector(){
  try{
    const d=await API.ibSector();
    if(!d) throw new Error('No data');
    ['MS','JP','GS'].forEach(function(k){
      renderIbSectorChart('ibSector-'+k, d[k]||[]);
    });
  }catch(e){
    console.error('ibSector',e);
    ['MS','JP','GS'].forEach(function(k){
      var el=document.getElementById('ibSector-'+k);
      if(el) el.innerHTML='<div class="no-data">데이터를 불러올 수 없습니다</div>';
    });
  }
}
function renderIbSectorChart(elId,items){
  var el=document.getElementById(elId);
  if(!el)return;
  if(!items.length){el.innerHTML='<div class="empty-txt">No data</div>';return}

  var maxAmt=Math.max.apply(null,items.map(function(s){return Math.abs(s.amount||0)}))||1;
  var html='';

  items.forEach(function(s){
    var amt=s.amount||0;
    var pct=Math.round(Math.abs(amt)/maxAmt*100);
    var isBuy=amt>0;
    var isZero=amt===0;
    var cls=isZero?'zero':(isBuy?'buy':'sell');
    var sign=isBuy?'+':'';
    var absAmt=Math.abs(amt);
    var dispAmt=absAmt>=10000?(absAmt/10000).toFixed(1)+'\uC870':absAmt.toLocaleString('ko-KR')+'\uC5B5';

    html+='<div class="ibs-row">';
    html+='<div class="ibs-nm">'+s.sector+'</div>';
    html+='<div class="ibs-bar-wrap">';
    html+='<div class="ibs-bar-left">';
    if(!isBuy&&!isZero) html+='<div class="ibs-bar sell" style="width:'+pct+'%"></div>';
    html+='</div>';
    html+='<div class="ibs-axis"></div>';
    html+='<div class="ibs-bar-right">';
    if(isBuy) html+='<div class="ibs-bar buy" style="width:'+pct+'%"></div>';
    html+='</div>';
    html+='</div>';
    html+='<div class="ibs-amt '+cls+'">'+sign+dispAmt+'</div>';
    html+='</div>';
  });

  el.innerHTML=html;
}


/* ═══════════════ Hong Signal Radar — 수급 주도주 전략 ═══════════════ */
async function loadHongSignal(){
  try{
    var d=await API.hongSignal();
    renderHongSignal(d);
  }catch(e){
    console.error('hongSignal',e);
    var tEl=document.getElementById('progTrend');
    if(tEl){tEl.textContent='DISCONNECTED';tEl.className='sp-trend negative'}
    var sEl=document.getElementById('leadingSectors');
    if(sEl)sEl.innerHTML='<div class="sp-empty">데이터 로드 실패</div>';
    var kEl=document.getElementById('signalStocks');
    if(kEl)kEl.innerHTML='<div class="sp-empty">데이터 로드 실패</div>';
  }
}
function renderHongSignal(d){
  if(!d)return;
  /* Timestamp */
  var timeEl=document.getElementById('signalTime');
  if(timeEl&&d.timestamp){
    var ts=d.timestamp.split(' ');
    timeEl.textContent=ts[1]||d.timestamp;
  }
  /* Badge */
  var badge=document.getElementById('signalBadge');
  if(badge){
    badge.className='signal-card__badge '+(d.marketHours?'live':'off');
    badge.textContent=d.marketHours?'LIVE':'CLOSED';
  }
  /* Program Flow */
  var prog=d.program||{};
  var trendEl=document.getElementById('progTrend');
  var gaugeEl=document.getElementById('progGauge');
  var slopeEl=document.getElementById('progSlope');
  var cumEl=document.getElementById('progCumNet');
  var ptsEl=document.getElementById('progPts');
  if(trendEl){
    var trend=prog.trend||'NO_DATA';
    var mp={'ACCELERATING':['ACCELERATING','accel'],'POSITIVE':['POSITIVE','positive'],
      'FLAT':['FLAT','flat'],'NEGATIVE':['NEGATIVE','negative'],'NO_DATA':['NO DATA','nodata'],
      'COLLECTING':['COLLECTING','positive']};
    var t=mp[trend]||mp['NO_DATA'];
    trendEl.textContent=t[0];trendEl.className='sp-trend '+t[1];
  }
  if(gaugeEl){
    var sl=Math.abs(prog.slope||0);
    var pct=Math.min(100,sl/50*100);
    gaugeEl.style.width=Math.max(2,pct)+'%';
    var tr=prog.trend||'flat';
    gaugeEl.className='sp-gauge '+(tr==='ACCELERATING'?'accel':tr==='POSITIVE'?'positive':tr==='NEGATIVE'?'negative':'flat');
  }
  if(slopeEl)slopeEl.textContent=(prog.slope>0?'+':'')+prog.slope;
  if(cumEl)cumEl.textContent=fNum(prog.cumNet||0);
  if(ptsEl)ptsEl.textContent=prog.dataPoints||0;
  /* Leading Sectors */
  var secEl=document.getElementById('leadingSectors');
  if(secEl){
    var sectors=d.leadingSectors||{};
    var keys=Object.keys(sectors);
    if(!keys.length){
      secEl.innerHTML='<div class="sp-empty">\uC8FC\uB3C4 \uC139\uD130 \uBBF8\uAC10\uC9C0</div>';
    }else{
      keys.sort(function(a,b){return sectors[b].count-sectors[a].count});
      secEl.innerHTML=keys.map(function(k){
        var s=sectors[k];
        var names=s.stocks.map(function(st){return st.name}).join(', ');
        return '<div><div class="sp-sector-tag">'
          +'<span class="sp-sector-nm">'+k+'</span>'
          +'<span class="sp-sector-cnt">'+s.count+'</span>'
          +'</div>'
          +'<div class="sp-sector-stocks" title="'+names+'">'+names+'</div></div>';
      }).join('');
    }
  }
  /* Signal Stocks */
  var stkEl=document.getElementById('signalStocks');
  if(stkEl){
    var sigs=d.signals||[];
    if(!sigs.length){
      stkEl.innerHTML='<div class="sp-empty">\uC2DC\uADF8\uB110 \uC885\uBAA9 \uC5C6\uC74C</div>';
    }else{
      stkEl.innerHTML=sigs.map(function(s){
        var expCls=s.explosive?' explosive':'';
        var p=s.changePct||0;
        var pc=p>0?'up':p<0?'dn':'fl';
        return '<div class="sp-stk'+expCls+'" onclick="openMo(\''+s.code+'\')">'
          +'<span class="sp-lvl '+s.level.toLowerCase()+'">'+s.level+'</span>'
          +'<span class="sp-stk-nm">'+s.name+'</span>'
          +'<span class="sp-stk-sec">'+s.sector+'</span>'
          +'<span class="sp-stk-val '+pc+'">'+(p>0?'+':'')+p.toFixed(1)+'%</span>'
          +'</div>';
      }).join('');
    }
  }
}


/* ═══════════════ Program Trading TOP ═══════════════ */
var _progData=null;
var _progShowAll=false;

async function loadProgramTop(){
  try{
    var d=await API.programTop();
    _progData=d||[];
    renderProgramTop(_progData);
  }catch(e){
    console.error('programTop',e);
    var el=document.getElementById('progBody');
    if(el)el.innerHTML='<tr><td colspan="6" style="text-align:center;color:var(--tx-3);padding:32px">데이터를 불러올 수 없습니다</td></tr>';
  }
}

function renderProgramTop(items){
  var el=document.getElementById('progBody');
  if(!el)return;
  var show=_progShowAll?50:20;
  var list=items.slice(0,show);
  if(!list.length){
    el.innerHTML='<tr><td colspan="6" style="text-align:center;color:var(--tx-3);padding:32px">No data</td></tr>';
    return;
  }
  el.innerHTML=list.map(function(s){
    var net=s.prm_netprps_amt||0;
    var netCls=net>=0?'buy':'sell';
    var absNet=Math.abs(net);
    /* 백만원 단위 → 억원 변환 */
    var netDisp=absNet>=100?(absNet/100).toFixed(0)+'억':absNet+'백만';
    var netSign=net>=0?'+':'-';
    var flu=s.flu_rt||0;
    var fluCls=flu>0?'up':flu<0?'dn':'fl';
    var mkt=(s.market||'').toLowerCase();
    return '<tr onclick="openMo(\''+s.stk_cd+'\')">'
      +'<td>'+s.rank+'</td>'
      +'<td class="p-nm">'+s.stk_nm+'</td>'
      +'<td><span class="p-mkt '+mkt+'">'+s.market+'</span></td>'
      +'<td class="p-prc">'+fNum(s.cur_prc)+'</td>'
      +'<td class="'+fluCls+'">'+(flu>0?'+':'')+flu.toFixed(2)+'%</td>'
      +'<td class="p-net '+netCls+'">'+netSign+netDisp+'</td>'
    +'</tr>';
  }).join('');
  /* Toggle button */
  var btn=document.getElementById('progToggle');
  if(btn){
    if(items.length<=20){btn.style.display='none'}
    else{
      btn.style.display='block';
      btn.textContent=_progShowAll?'접기 \u25B2':'더보기 \u25BC ('+items.length+'종목)';
    }
  }
}

window.toggleProg=function(){
  _progShowAll=!_progShowAll;
  if(_progData)renderProgramTop(_progData);
};


/* ═══════════════ Stealth Accumulation ═══════════════ */
async function loadAccumulation(){
  try{
    var d=await API.accumulation();
    if(!d||!d.length){
      document.getElementById('accumCards').innerHTML='<div class="stealth-empty">No data</div>';
      document.getElementById('accumTable').innerHTML='<tr><td colspan="11" class="stealth-empty">No data</td></tr>';
      return;
    }
    renderAccumCards(d.slice(0,5));
    renderAccumTable(d);
  }catch(e){
    console.error('accumulation',e);
    document.getElementById('accumCards').innerHTML='<div class="stealth-empty">데이터를 불러올 수 없습니다</div>';
    document.getElementById('accumTable').innerHTML='<tr><td colspan="11" class="stealth-empty">데이터를 불러올 수 없습니다</td></tr>';
  }
}

function renderAccumCards(items){
  var el=document.getElementById('accumCards');
  if(!el)return;
  el.innerHTML=items.map(function(s){
    var g=s.grade.toLowerCase();
    var c5=s.wght_change_5d,c20=s.wght_change_20d;
    var c5cls=c5>=0?'pos':'neg',c20cls=c20>=0?'pos':'neg';
    var sigCls=s.signal.toLowerCase();
    return '<div class="accum-card" data-grade="'+s.grade+'" onclick="openMo(\''+s.stk_cd+'\')">'
      +'<div class="accum-card__hd">'
        +'<span class="accum-grade grade-'+g+'">'+s.grade+'</span>'
        +'<span class="accum-card__nm">'+s.stk_nm+'</span>'
      +'</div>'
      +'<div class="accum-card__score">'+s.accumulation_score+'</div>'
      +'<div class="accum-card__score-lbl">Accumulation Score</div>'
      +'<div class="accum-sparkline" data-values="'+(s.sparkline||[]).join(',')+'"></div>'
      +'<div class="accum-card__chg">'
        +'<span><span class="lbl">5D</span><span class="'+c5cls+'">'+(c5>=0?'+':'')+c5+'%p</span></span>'
        +'<span><span class="lbl">20D</span><span class="'+c20cls+'">'+(c20>=0?'+':'')+c20+'%p</span></span>'
      +'</div>'
      +'<div class="accum-signal '+sigCls+'">'+s.signal.replace(/_/g,' ')+'</div>'
    +'</div>';
  }).join('');
  /* Draw sparklines — use setTimeout to ensure layout is complete */
  setTimeout(function(){
    el.querySelectorAll('.accum-sparkline').forEach(drawAccumSparkline);
  },100);
}

function renderAccumTable(items){
  var el=document.getElementById('accumTable');
  if(!el)return;
  el.innerHTML=items.map(function(s,i){
    var g=s.grade.toLowerCase();
    var c5=s.wght_change_5d,c20=s.wght_change_20d;
    var c5cls=c5>0?'tbl-pos':c5<0?'tbl-neg':'tbl-zero';
    var c20cls=c20>0?'tbl-pos':c20<0?'tbl-neg':'tbl-zero';
    var exhCls=s.exh_rt_incrs>0?'tbl-pos':s.exh_rt_incrs<0?'tbl-neg':'tbl-zero';
    var sigCls=s.signal.toLowerCase();
    return '<tr>'
      +'<td>'+(s.rank||i+1)+'</td>'
      +'<td class="tbl-nm" onclick="openMo(\''+s.stk_cd+'\')">'+s.stk_nm+'</td>'
      +'<td class="tbl-score">'+s.accumulation_score+'</td>'
      +'<td><span class="accum-grade grade-'+g+'" style="font-size:10px">'+s.grade+'</span></td>'
      +'<td>'+s.wght_now+'%</td>'
      +'<td class="'+c5cls+'">'+(c5>=0?'+':'')+c5+'%p</td>'
      +'<td class="'+c20cls+'">'+(c20>=0?'+':'')+c20+'%p</td>'
      +'<td class="'+exhCls+'">'+(s.exh_rt_incrs>=0?'+':'')+s.exh_rt_incrs+'%p</td>'
      +'<td>'+(s.consecutive_days||0)+'일</td>'
      +'<td><div class="mini-spark" data-values="'+(s.sparkline||[]).join(',')+'"></div></td>'
      +'<td><span class="accum-signal '+sigCls+'" style="font-size:9px;padding:2px 6px">'+s.signal.replace(/_/g,' ')+'</span></td>'
    +'</tr>';
  }).join('');
  setTimeout(function(){
    el.querySelectorAll('.mini-spark').forEach(drawAccumSparkline);
  },100);
}

function drawAccumSparkline(el){
  var raw=el.dataset.values;
  if(!raw)return;
  var values=raw.split(',').map(Number).filter(function(v){return !isNaN(v)});
  if(values.length<2)return;

  var isMini=el.classList.contains('mini-spark');
  var w=isMini?80:160;
  var h=isMini?24:36;
  var pad=3;
  var mn=Math.min.apply(null,values),mx=Math.max.apply(null,values);
  var range=mx-mn||1;

  var pts=values.map(function(v,i){
    var x=Math.round((i/(values.length-1))*w*10)/10;
    var y=Math.round((h-pad-((v-mn)/range)*(h-pad*2))*10)/10;
    return x+','+y;
  });

  var polyPts=pts.join(' ');
  var fillPts=polyPts+' '+w+','+h+' 0,'+h;

  el.innerHTML='<svg viewBox="0 0 '+w+' '+h+'" preserveAspectRatio="none" width="100%" height="100%">'
    +'<polygon points="'+fillPts+'"/>'
    +'<polyline points="'+polyPts+'"/>'
    +'</svg>';
}


/* ═══════════════ Institutions (5D buy + sell ranking) ═══════════════ */
const sellDataStore={};
const IB_META={
  MS:{name:'Morgan Stanley',cls:'ms'},
  JP:{name:'JP Morgan',cls:'jp'},
  GS:{name:'Goldman Sachs',cls:'gs'}
};

async function loadInst(){
  try{
    const d=await API.inst();
    if(!d){throw new Error('No data')}
    ['MS','JP','GS'].forEach(k=>{
      const inst=d[k];
      const el=document.getElementById(k+'-col');
      if(!el)return;
      if(!inst||(!((inst.buyTop||[]).length) && !((inst.sellTop||[]).length))){
        el.innerHTML='<div class="no-data">데이터 없음</div>';
        return;
      }
      /* Store sell data for popup */
      sellDataStore[k]=inst.sellTop||[];
      let html='';
      /* BUY section only */
      html+='<div class="ib-sub-hd buy">Net Buy TOP 20</div>';
      html+=rInstItems(inst.buyTop||[],false);
      /* Sell toggle button */
      const sellCnt=(inst.sellTop||[]).length;
      if(sellCnt>0){
        html+='<div class="sell-toggle-btn" onclick="openSellPopup(\''+k+'\')">'
          +'<span class="arrow">\u25BC</span> NET SELL TOP '+sellCnt+' 보기'
          +'</div>';
      }
      el.innerHTML=html;
    });
  }catch(e){
    console.error('inst',e);
    ['MS-col','JP-col','GS-col'].forEach(id=>{
      const el=document.getElementById(id);
      if(el)el.innerHTML='<div class="no-data">데이터를 불러올 수 없습니다</div>';
    });
  }
}
function rInstItems(stocks,isSell){
  if(!stocks||!stocks.length)return'<div class="empty-txt">No data</div>';
  const topN=stocks.slice(0,20);
  const maxAmt=Math.max(...topN.map(s=>Math.abs(s.amount||0)))||1;
  return topN.map((s,i)=>{
    const p=s.changePct||0,pc=p>0?'up':p<0?'dn':'fl';
    const amtPct=Math.round(Math.abs(s.amount||0)/maxAmt*100);
    const barColor=isSell?'var(--c-down)':(p>0?'var(--c-up)':p<0?'var(--c-down)':'var(--tx-3)');
    const amtDisplay=isSell?fAmt(-(Math.abs(s.amount||0))):fAmt(s.amount||0);
    const amtCls=isSell?'dn':pc;
    var cd=s.code||'';
    var click=cd?'onclick="openMo(\''+cd+'\')"':'style="cursor:default;opacity:.6"';
    return'<div class="is-item" '+click+'>'
      +'<div class="is-top">'
        +'<span class="is-rk">'+(i+1)+'</span>'
        +'<span class="is-nm">'+s.name+'</span>'
        +'<span class="is-amt '+amtCls+'">'+amtDisplay+'</span>'
      +'</div>'
      +'<div class="is-bot">'
        +'<span class="is-bar"><span class="is-fill" style="width:'+amtPct+'%;background:'+barColor+'"></span></span>'
        +'<span class="is-chg '+pc+'">'+(p>0?'+':'')+p.toFixed(1)+'%</span>'
      +'</div>'
    +'</div>';
  }).join('');
}


/* ═══════════════ Sell Popup ═══════════════ */
window.openSellPopup=function(ibKey){
  const overlay=document.getElementById('sellOverlay');
  const body=document.getElementById('sellPopBody');
  const logo=document.getElementById('sellPopLogo');
  const nm=document.getElementById('sellPopNm');
  if(!overlay||!body)return;
  const meta=IB_META[ibKey]||{name:ibKey,cls:''};
  logo.className='sell-popup__logo '+meta.cls;
  logo.textContent=ibKey;
  nm.textContent=meta.name;
  const items=sellDataStore[ibKey]||[];
  if(!items.length){
    body.innerHTML='<div class="empty-txt">No data</div>';
  }else{
    body.innerHTML='<div class="ib-sub-hd sell">Net Sell TOP '+items.length+'</div>'
      +rInstItems(items,true);
  }
  overlay.classList.add('on');
};
function closeSellPopup(){document.getElementById('sellOverlay').classList.remove('on')}

/* ═══════════════ Stock Modal ═══════════════ */
window.openMo=async function(code){
  if(!code||code==='undefined'||code==='null'){console.warn('openMo: invalid code',code);return}
  const mo=document.getElementById('mo'),bd=document.getElementById('mo-bd');
  if(!mo||!bd)return;
  mo.classList.add('on');
  bd.innerHTML='<div class="mo-loading">Loading...</div>';
  document.getElementById('mo-nm').textContent='';
  document.getElementById('mo-cd').textContent=code;
  try{
    const d=await API.stock(code);
    if(!d){bd.innerHTML='<div class="err-txt">No data</div>';return}
    document.getElementById('mo-nm').textContent=d.name||'';
    document.getElementById('mo-cd').textContent=code;
    const c=sigCls(d.signal),ar=sigArrow(d.signal);
    const ch=d.change||0,p=d.changePct||0;
    bd.innerHTML=`
      <div class="mo-prc-row">
        <span class="mo-prc">${fNum(d.curPrc||0)}\uC6D0</span>
        <span class="mo-prc-chg ${c}">${ar} ${ch>0?'+':''}${fNum(Math.abs(ch))} (${p>0?'+':''}${p.toFixed(2)}%)</span>
      </div>
      <div class="mo-grid">
        <div class="mo-f"><span class="mo-fl">Open</span><span class="mo-fv">${fNum(d.open||0)}</span></div>
        <div class="mo-f"><span class="mo-fl">High</span><span class="mo-fv">${fNum(d.high||0)}</span></div>
        <div class="mo-f"><span class="mo-fl">Low</span><span class="mo-fv">${fNum(d.low||0)}</span></div>
        <div class="mo-f"><span class="mo-fl">Volume</span><span class="mo-fv">${fNum(d.volume||0)}</span></div>
        <div class="mo-f"><span class="mo-fl">Market Cap</span><span class="mo-fv">${fCap(d.marketCap||0)}</span></div>
        <div class="mo-f"><span class="mo-fl">PER</span><span class="mo-fv">${(d.per||0).toFixed(2)}</span></div>
        <div class="mo-f"><span class="mo-fl">PBR</span><span class="mo-fv">${(d.pbr||0).toFixed(2)}</span></div>
        <div class="mo-f"><span class="mo-fl">Foreign %</span><span class="mo-fv">${(d.foreignRate||0).toFixed(1)}%</span></div>
      </div>`;
  }catch(e){bd.innerHTML='<div class="err-txt">Failed to load data</div>'}
};
function closeMo(){document.getElementById('mo').classList.remove('on')}

})();

</script>
</body>
</html>
